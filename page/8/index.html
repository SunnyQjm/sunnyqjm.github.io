<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="建明 | Ming.J">
<meta property="og:url" content="http://qjm253.cn/page/8/index.html">
<meta property="og:site_name" content="建明 | Ming.J">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="建明 | Ming.J">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'ANPOHDJJYB',
      apiKey: '',
      indexName: 'Ming.J blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://qjm253.cn/page/8/"/>





  <title>建明 | Ming.J - 至清  至静</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0a9fa95ff997969441c084d8d73eacfb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">建明 | Ming.J</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">至清  至静</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-games">
          <a href="/game/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-gamepad"></i> <br />
            
            游戏
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2017/10/24/2017-10-24-2017级Android第一次例会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-r.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/2017-10-24-2017级Android第一次例会/" itemprop="url">2017级Android第一次例会</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-24T00:00:00+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/24/2017-10-24-2017级Android第一次例会/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/24/2017-10-24-2017级Android第一次例会/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/24/2017-10-24-2017级Android第一次例会/" class="leancloud_visitors" data-flag-title="2017级Android第一次例会">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="Android-前世今生"><a href="#Android-前世今生" class="headerlink" title="Android 前世今生"></a>Android 前世今生</h2></blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">版本名称</th>
<th style="text-align:center">版本号</th>
<th style="text-align:center">发布时间</th>
<th style="text-align:center">API版本</th>
<th style="text-align:center">官方支持状态</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Android (Alpha)</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">September 23, 2008</td>
<td style="text-align:center">1</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Beta (Internally known as “Petit Four”)</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">February 9, 2009</td>
<td style="text-align:center">2</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Cupcake（纸杯蛋糕）</td>
<td style="text-align:center">1.5</td>
<td style="text-align:center">April 27, 2009</td>
<td style="text-align:center">3</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Donut（甜甜圈）</td>
<td style="text-align:center">1.6</td>
<td style="text-align:center">September 15, 2009</td>
<td style="text-align:center">4</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Eclair（闪电泡芙）</td>
<td style="text-align:center">2.0 – 2.1</td>
<td style="text-align:center">October 26, 2009</td>
<td style="text-align:center">5 – 7</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Froyo（冻酸奶）</td>
<td style="text-align:center">2.2 – 2.2.3</td>
<td style="text-align:center">May 20, 2010</td>
<td style="text-align:center">8</td>
<td style="text-align:center">不支持</td>
<td></td>
</tr>
<tr>
<td style="text-align:center">Gingerbread（姜饼）</td>
<td style="text-align:center">2.3 – 2.3.7</td>
<td style="text-align:center">December 6, 2010</td>
<td style="text-align:center">9 – 10</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Honeycomb（蜂巢）</td>
<td style="text-align:center">3.0 – 3.2.6</td>
<td style="text-align:center">February 22, 2011</td>
<td style="text-align:center">11 – 13</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Ice Cream Sandwich（冰淇淋三明治）</td>
<td style="text-align:center">4.0 – 4.0.4</td>
<td style="text-align:center">October 18, 2011</td>
<td style="text-align:center">14 – 15</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Jelly Bean（果冻豆）</td>
<td style="text-align:center">4.1 – 4.3.1</td>
<td style="text-align:center">July 9, 2012</td>
<td style="text-align:center">16 – 18</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">KitKat（奇巧巧克力棒）</td>
<td style="text-align:center">4.4 – 4.4.4</td>
<td style="text-align:center">October 31, 2013</td>
<td style="text-align:center">19</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Lollipop（棒棒糖）</td>
<td style="text-align:center">5.0 – 5.1.1</td>
<td style="text-align:center">November 12, 2014</td>
<td style="text-align:center">21 – 22</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Marshmallow（棉花糖）</td>
<td style="text-align:center">6.0 – 6.0.1</td>
<td style="text-align:center">October 5, 2015</td>
<td style="text-align:center">23</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Nougat（牛轧糖）</td>
<td style="text-align:center">7.0 – 7.1.2</td>
<td style="text-align:center">August 22, 2016</td>
<td style="text-align:center">24 – 25</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">O/Oreo（奥利奥）</td>
<td style="text-align:center">8.0</td>
<td style="text-align:center">August 22, 2017</td>
<td style="text-align:center">26</td>
<td style="text-align:center">支持</td>
</tr>
</tbody>
</table>
<blockquote>
<h2 id="开发语言"><a href="#开发语言" class="headerlink" title="开发语言"></a>开发语言</h2><p>组里主要以Java语言为主，同时会介绍一些Kotlin开发Android。<br>90% Java + 10% Kotlin</p>
</blockquote>
<ul>
<li>Java</li>
<li>Kotlin</li>
<li>C++</li>
<li>…</li>
</ul>
<blockquote>
<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2></blockquote>
<ul>
<li>Eclipse（拒绝）</li>
<li>Visual Studio</li>
<li>Android Studio(推荐)<ul>
<li>2.3（稳定版）==&gt;不支持Kotlin</li>
<li>3.0（pre）==&gt;支持Kotlin，对Java8有较好的支持</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="Java-环境配置："><a href="#Java-环境配置：" class="headerlink" title="Java 环境配置："></a>Java 环境配置：</h2><p>Kotlin 可以基于JVM，不需要额外配置，IDEA中可直接创建Kotlin项目</p>
</blockquote>
<ul>
<li><a href="http://www.jianshu.com/p/21abe20aadf2" target="_blank" rel="noopener">点此传送进行Java环境配置</a>（<a href="http://www.jianshu.com/p/21abe20aadf2）" target="_blank" rel="noopener">http://www.jianshu.com/p/21abe20aadf2）</a><ul>
<li>最好是下专业版IDEA（专业版需要注册码，可以用学校邮箱注册学生账号，可免费一年，过期需要手动再次激活）</li>
</ul>
</li>
<li>Java书籍推荐<ul>
<li>入门：《Java核心技术 卷Ⅰ》、《疯狂Java讲义》</li>
<li>进阶：《Java编程思想》、《Java核心技术 卷Ⅱ》</li>
<li>强烈安利：《Effective Java》（这本书建议对Java有一定的熟悉程度，并有一定开发经验之后再看，会受益匪浅）</li>
</ul>
</li>
<li>电子书资源：<ul>
<li><a href="http://pan.baidu.com/s/1boXCxbT" target="_blank" rel="noopener">点我下载</a>（<a href="http://pan.baidu.com/s/1boXCxbT）" target="_blank" rel="noopener">http://pan.baidu.com/s/1boXCxbT）</a></li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="Android环境配置"><a href="#Android环境配置" class="headerlink" title="Android环境配置"></a>Android环境配置</h2></blockquote>
<ul>
<li><a href="https://developers.google.cn/" target="_blank" rel="noopener">Google Developer </a>（<a href="https://developers.google.cn/）" target="_blank" rel="noopener">https://developers.google.cn/）</a><ul>
<li><a href="https://developer.android.google.cn/index.html" target="_blank" rel="noopener">Google Android Developer</a></li>
</ul>
</li>
<li>IDE 下载：<ul>
<li>建议下载最新的Android Studio3.0预览版（稳定版和预览版可以共存，所以你也可以2.3和3.0都装）</li>
<li><a href="https://developer.android.google.cn/studio/archive.html" target="_blank" rel="noopener">官网下载 </a></li>
<li><a href="http://www.android-studio.org/" target="_blank" rel="noopener">Android中文社区，可下载2.3.3和3.0预览版稳定版AS</a>（<a href="http://www.android-studio.org/）" target="_blank" rel="noopener">http://www.android-studio.org/）</a></li>
</ul>
</li>
<li>环境配置<ul>
<li><a href="http://blog.csdn.net/siwuxie095/article/details/53431818" target="_blank" rel="noopener">CSDN教程</a></li>
<li><a href="http://www.jikexueyuan.com/course/636.html" target="_blank" rel="noopener">极客学院视频教程</a></li>
</ul>
</li>
<li><a href="http://ke.jikexueyuan.com/zhiye/android/" target="_blank" rel="noopener">极客学院视频</a></li>
<li><a href="http://pan.baidu.com/s/1gfozi4z" target="_blank" rel="noopener">极客学院离线视频资源</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2017/10/17/2017-10-17-数据库笔记（十）——关系代数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-r.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/17/2017-10-17-数据库笔记（十）——关系代数/" itemprop="url">数据库笔记（十）——关系代数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-17T00:00:00+08:00">
                2017-10-17
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/17/2017-10-17-数据库笔记（十）——关系代数/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/17/2017-10-17-数据库笔记（十）——关系代数/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/17/2017-10-17-数据库笔记（十）——关系代数/" class="leancloud_visitors" data-flag-title="数据库笔记（十）——关系代数">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="基本运算"><a href="#基本运算" class="headerlink" title="基本运算"></a>基本运算</h2><p>每一种基本运算的结果都是一个新的关系，可以用这个关系继续参与运算，借此便可进行复杂的运算</p>
</blockquote>
<ul>
<li><h3 id="选择运算（select）-gt-相当于SQL语句中的WHERE子句的职能"><a href="#选择运算（select）-gt-相当于SQL语句中的WHERE子句的职能" class="headerlink" title="选择运算（select）==&gt;相当于SQL语句中的WHERE子句的职能"></a>选择运算（select）==&gt;相当于SQL语句中的WHERE子句的职能</h3><ul>
<li><h4 id="格式：σ选择谓词-关系"><a href="#格式：σ选择谓词-关系" class="headerlink" title="格式：σ选择谓词(关系)"></a>格式：σ<sub>选择谓词</sub>(关系)</h4></li>
<li><p>举个栗子：</p>
<ul>
<li><p>σ<sub>SAL&gt;1000</sub>(EMP)</p>
</li>
<li><p>上式表示取出查询工资大于1000的所有员工的信息</p>
</li>
<li>等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">1000</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>选择谓词的分类</p>
<ul>
<li>比较：=、≠、&lt;、≤、&gt;和≥</li>
<li>连词：and(∧)、or(∨)和not(¬)==&gt;可以将多个谓词合并成一个大的谓词</li>
<li>可以包括两个属性（字段的比较）：σ<sub>COMM&gt;SAL</sub>(EMP)表示抽成大于工资的人</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="投影运算（project）-gt-相当于SQL语句中的SELECT子句的职能"><a href="#投影运算（project）-gt-相当于SQL语句中的SELECT子句的职能" class="headerlink" title="投影运算（project）==&gt;相当于SQL语句中的SELECT子句的职能"></a>投影运算（project）==&gt;相当于SQL语句中的SELECT子句的职能</h3><ul>
<li><h4 id="格式：∏字段序列-关系"><a href="#格式：∏字段序列-关系" class="headerlink" title="格式：∏字段序列(关系)"></a>格式：∏<sub>字段序列</sub>(关系)</h4></li>
<li><p>举个栗子</p>
<ul>
<li><p>∏<sub>ENAME,SAL</sub>(EMP)</p>
</li>
<li><p>上式表示查看所有员工的姓名和工资</p>
</li>
<li>等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="关系的组合运算-gt-就像SQL中select、where子句那样的组合效果"><a href="#关系的组合运算-gt-就像SQL中select、where子句那样的组合效果" class="headerlink" title="关系的组合运算==&gt;就像SQL中select、where子句那样的组合效果"></a>关系的组合运算==&gt;就像SQL中select、where子句那样的组合效果</h3><ul>
<li><p>举个栗子</p>
<ul>
<li><p>∏<sub>ENAME,SAL</sub>(σ<sub>SAL&gt;1000</sub>(EMP))</p>
</li>
<li><p>上面的式子求出了所有工资大于1000的员工的名字和工资(实际上就是将<strong>σ<sub>SAL&gt;1000</sub>(EMP)</strong>执行的结果当做一个临时的关系，参与了投影运算得到的)</p>
</li>
<li>等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">1000</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>事实关系的组合运算就是那么简单，分析的时候把每个简单运算的结果当做一个新的关系参与后面的运算，这样一层层剥开来，再复杂的语句也变得容易分析</p>
</li>
</ul>
</li>
<li><h3 id="并运算（union）-gt-相当于SQL中UNION关键字的职能"><a href="#并运算（union）-gt-相当于SQL中UNION关键字的职能" class="headerlink" title="并运算（union）==&gt;相当于SQL中UNION关键字的职能"></a>并运算（union）==&gt;相当于SQL中UNION关键字的职能</h3><ul>
<li><h4 id="格式：（关系r）∪（关系s）"><a href="#格式：（关系r）∪（关系s）" class="headerlink" title="格式：（关系r）∪（关系s）"></a>格式：（关系r）∪（关系s）</h4></li>
<li><p>举个栗子</p>
<ul>
<li><p>∏<sub>ENAME,SAL</sub>(σ<sub>SAL&gt;1000</sub>(EMP)) ∪ ∏<sub>ENAME,SAL</sub>(σ<sub>COMM&gt;300</sub>(EMP))</p>
</li>
<li><p>上面的式子求出了所有工资大于1000或抽成大于300的员工的姓名和工资，等价于下面的SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">1000</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> COMM &gt; <span class="number">300</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>几点需要额外注意的</strong>：</p>
<ul>
<li><p>此处的并运算是集合运算，所以结果是去重的，结果集中不存在重复的元组（<strong><em>而在SQL语句中，指定UNION ALL是可以保留重复的</em></strong>）</p>
</li>
<li><p>关系r与关系s必须是同元的，即它们的属性的数目要求必须相同（这就和SQL语句中UNION使用的时候要求上下两个语句的字段数相同是一样的意思）</p>
</li>
<li>关系r和关系s对应位置的属性域应该是类型兼容的（同样和SQL中UNION使用时，每个对应位置字段类型兼容是一样的意思）</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="集合的差运算（set-defference）-gt-相当于SQL语句中的EXCEPT"><a href="#集合的差运算（set-defference）-gt-相当于SQL语句中的EXCEPT" class="headerlink" title="集合的差运算（set-defference）==&gt;相当于SQL语句中的EXCEPT"></a>集合的差运算（set-defference）==&gt;相当于SQL语句中的EXCEPT</h3><ul>
<li><h4 id="格式：-关系r-关系s"><a href="#格式：-关系r-关系s" class="headerlink" title="格式：(关系r)-(关系s)"></a>格式：(关系r)-(关系s)</h4></li>
<li><p>举个栗子</p>
<ul>
<li>∏<sub>ENAME,SAL</sub>(σ<sub>SAL&gt;1000</sub>(EMP)) - ∏<sub>ENAME,SAL</sub>(σ<sub>COMM&gt;300</sub>(EMP))</li>
<li>上面的式子表示工资大于1000但抽成不大于300的员工的姓名和工资，等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">1000</span></span><br><span class="line"><span class="keyword">EXCEPT</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> COMM &gt; <span class="number">300</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>几点需要额外注意的</strong>：</p>
<ul>
<li>此处的注意同上面的并运算的注意事项</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="笛卡尔积运算（Cartesian-product）-gt-等价于SQL语句中两个表进行笛卡尔积（全匹配）得到的结果，即SQL中进行多表连接时不指定连接条件的情况"><a href="#笛卡尔积运算（Cartesian-product）-gt-等价于SQL语句中两个表进行笛卡尔积（全匹配）得到的结果，即SQL中进行多表连接时不指定连接条件的情况" class="headerlink" title="笛卡尔积运算（Cartesian-product）==&gt;等价于SQL语句中两个表进行笛卡尔积（全匹配）得到的结果，即SQL中进行多表连接时不指定连接条件的情况"></a>笛卡尔积运算（Cartesian-product）==&gt;等价于SQL语句中两个表进行笛卡尔积（全匹配）得到的结果，即SQL中进行多表连接时不指定连接条件的情况</h3><ul>
<li><h4 id="格式：-关系r-×-关系"><a href="#格式：-关系r-×-关系" class="headerlink" title="格式：(关系r)×(关系)"></a>格式：(关系r)×(关系)</h4></li>
<li><p>举个栗子：</p>
<ul>
<li>EMP × DEPT</li>
<li>上面的式子表示两个表进行全匹配，等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> EMP, DEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>下面两个式子是等价的</p>
<ul>
<li><strong>∏<sub>ENAME,DNAME</sub>(σ<sub>EMP.DEPTNO=DEPT.DEPTNO</sub>(σ<sub>JOB=”MANAGER”</sub>(EMP×DEPT)))</strong></li>
<li><strong>∏<sub>ENAME,DNAME</sub>(σ<sub>EMP.DEPTNO=DEPT.DEPTNO</sub>((σ<sub>JOB=”MANAGER”</sub>(EMP))×DEPT)</strong></li>
<li>下面是对这两个式子的SQL转化，转化之后就一目了然了<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对应第一个式子</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP <span class="keyword">JOIN</span> DEPT <span class="keyword">ON</span> EMP.DEPTNO = DEPT.DEPTNO</span><br><span class="line"><span class="keyword">WHERE</span> JOB = <span class="string">'MANAGER'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对应第二个式子</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, DNAME</span><br><span class="line"><span class="keyword">FROM</span> DEPT <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> *</span><br><span class="line">                <span class="keyword">FROM</span> EMP</span><br><span class="line">                <span class="keyword">WHERE</span> JOB = <span class="string">'MANAGER'</span>)</span><br><span class="line">          <span class="keyword">ON</span> EMP.DEPTNO = DEPT.DEPTNO</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="更名运算（rename）-gt-等价于SQL语句中as的职能"><a href="#更名运算（rename）-gt-等价于SQL语句中as的职能" class="headerlink" title="更名运算（rename）==&gt;等价于SQL语句中as的职能"></a>更名运算（rename）==&gt;等价于SQL语句中as的职能</h3><ul>
<li><h4 id="格式：ρX-A1-A2-…-An-E-gt-表示的是将关系E更名为X，Ai表示的是给E的第i个字段指定别名"><a href="#格式：ρX-A1-A2-…-An-E-gt-表示的是将关系E更名为X，Ai表示的是给E的第i个字段指定别名" class="headerlink" title="格式：ρX(A1,A2,…,An)(E)==&gt;表示的是将关系E更名为X，Ai表示的是给E的第i个字段指定别名"></a>格式：ρ<sub>X(A<sub>1</sub>,A<sub>2</sub>,…,A<sub>n</sub>)</sub>(E)==&gt;表示的是将关系E更名为X，A<sub>i</sub>表示的是给E的第i个字段指定别名</h4></li>
<li>举个栗子<ul>
<li>∏<sub>ENAME,DNAME</sub>(σ<sub>e.DEPTNO=d.DEPTNO</sub>(σ<sub>JOB=”MANAGER”</sub>(ρ<sub>e</sub>(EMP)×ρ<sub>d</sub>(DEPT))))</li>
<li>上面式子含义就不解释了，是上面举的栗子，只是引入了更名运算符，它等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO</span><br><span class="line"><span class="keyword">WHERE</span> JOB = <span class="string">'MANAGER'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="来，学习完上面的基本运算，来做个实际的栗子，要求找到员工表中的最高工资（因为目前还没有介绍类似SQL中组函数的操作，后面会介绍。所以通过以下方式来实现）"><a href="#来，学习完上面的基本运算，来做个实际的栗子，要求找到员工表中的最高工资（因为目前还没有介绍类似SQL中组函数的操作，后面会介绍。所以通过以下方式来实现）" class="headerlink" title="来，学习完上面的基本运算，来做个实际的栗子，要求找到员工表中的最高工资（因为目前还没有介绍类似SQL中组函数的操作，后面会介绍。所以通过以下方式来实现）"></a>来，学习完上面的基本运算，来做个实际的栗子，要求找到员工表中的最高工资（因为目前还没有介绍类似SQL中组函数的操作，后面会介绍。所以通过以下方式来实现）</h3><ul>
<li>step1: 找到所有不是最高工资的人<ul>
<li><strong>∏<sub>e1.SAL</sub>(σ<sub>e<sub>1</sub>.sal &lt; e<sub>2</sub>.sal</sub>(ρ<sub>e<sub>1</sub></sub>(EMP)×ρ<sub>e<sub>2</sub></sub>(EMP)))</strong></li>
</ul>
</li>
<li>step2: 用所有的员工减去上面的员工，即得到最高工资<ul>
<li><strong>∏<sub>SAL</sub>(EMP) - ∏<sub>e1.SAL</sub>(σ<sub>e<sub>1</sub>.sal &lt; e<sub>2</sub>.sal</sub>(ρ<sub>e<sub>1</sub></sub>(EMP)×ρ<sub>e<sub>2</sub></sub>(EMP)))</strong></li>
</ul>
</li>
</ul>
</li>
<li><h3 id="在书写关系运算表达式的时候可以用序列号代替字段名（但是不直观，不常用，一般不用）"><a href="#在书写关系运算表达式的时候可以用序列号代替字段名（但是不直观，不常用，一般不用）" class="headerlink" title="在书写关系运算表达式的时候可以用序列号代替字段名（但是不直观，不常用，一般不用）"></a>在书写关系运算表达式的时候可以用序列号代替字段名（但是不直观，不常用，一般不用）</h3><ul>
<li>举个栗子<ul>
<li>∏<sub>$6</sub>(σ<sub>$6 &lt; $14</sub>(EMP×EMP))</li>
<li>等价于下面的运算</li>
<li>∏<sub>e1.SAL</sub>(σ<sub>e<sub>1</sub>.sal &lt; e<sub>2</sub>.sal</sub>(ρ<sub>e<sub>1</sub></sub>(EMP)×ρ<sub>e<sub>2</sub></sub>(EMP)))</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="附加运算"><a href="#附加运算" class="headerlink" title="附加运算"></a>附加运算</h2><p>附加运算是由基本运算组成的，不能增强基本运算的运算能力，但是能简化运算</p>
</blockquote>
<ul>
<li><h3 id="集合交运算（intersection）-gt-相当于SQL语句中INTERSECT关键字的职能"><a href="#集合交运算（intersection）-gt-相当于SQL语句中INTERSECT关键字的职能" class="headerlink" title="集合交运算（intersection）==&gt;相当于SQL语句中INTERSECT关键字的职能"></a>集合交运算（intersection）==&gt;相当于SQL语句中INTERSECT关键字的职能</h3><ul>
<li><h4 id="格式：-关系r-∩-关系s"><a href="#格式：-关系r-∩-关系s" class="headerlink" title="格式：(关系r)∩(关系s)"></a>格式：(关系r)∩(关系s)</h4></li>
<li>因为集合交运算是可以由前面的基本运算组合产生的，所以把它归到附加运算<ul>
<li>A ∩ B &lt;=&gt; A - (A - B)</li>
</ul>
</li>
<li>举个栗子<ul>
<li>∏<sub>ENAME,SAL</sub>(σ<sub>SAL&gt;1000</sub>(EMP)) ∩ ∏<sub>ENAME,SAL</sub>(σ<sub>COMM&gt;300</sub>(EMP))</li>
<li>上面的式子表示工资大于1000并且抽成大于300的员工的姓名和工资，等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">1000</span></span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> COMM &gt; <span class="number">300</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="自然连接（natural-join）-gt-相当于SQL语句中的NATURAL-JOIN"><a href="#自然连接（natural-join）-gt-相当于SQL语句中的NATURAL-JOIN" class="headerlink" title="自然连接（natural join）==&gt; 相当于SQL语句中的NATURAL JOIN"></a>自然连接（natural join）==&gt; 相当于SQL语句中的NATURAL JOIN</h3><ul>
<li><h4 id="格式：-关系-⋈-关系"><a href="#格式：-关系-⋈-关系" class="headerlink" title="格式：(关系)⋈(关系)"></a>格式：(关系)⋈(关系)</h4></li>
<li><h4 id="自然连接的形式化定义"><a href="#自然连接的形式化定义" class="headerlink" title="自然连接的形式化定义"></a>自然连接的形式化定义</h4><ul>
<li>r,s是两个关系</li>
<li>R，S是上面两个关系对应的关系模式（其实就是上述两个关系各自的属性列表）</li>
<li>R ∩ S 表示r和s的同名属性列表</li>
<li>R ∪ S 表示出现在r或s上的属性名列表(是一个集合，不包同名属性，存在同名属性会去重)</li>
<li>R - S 表示出现在R上，但不出现在S上的属性名列表</li>
<li>则可做如下定义</li>
<li>r⋈s = ∏<sub>R∪S</sub>(σ<sub>r.A<sub>1</sub>=s.A<sub>1</sub> ∧ r.A<sub>2</sub>=s.A<sub>2</sub> ∧ … ∧ r.A<sub>n</sub>=s.A<sub>n</sub></sub>(r×s)) ，其中 R∩S={A<sub>1</sub>, A<sub>2</sub>, …, A<sub>n</sub>}</li>
</ul>
</li>
<li>举个栗子<ul>
<li>∏<sub>name, course_id</sub>(instructor ⋈ teaches)</li>
<li>上面的式子列出了所有老师的名字以及其所授课程的id，等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, course_id</span><br><span class="line"><span class="keyword">FROM</span> intructor <span class="keyword">natural</span> <span class="keyword">join</span> teaches</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ps: 两个关系模式执行自然连接以后属性的排布顺序：</p>
<ul>
<li>排在最前面的是两个关系模式相同的属性</li>
<li>其次是只属于第一个关系模式的属性</li>
<li>最后是只属于第二个关系模式的属性<h4 id="！！！所以所两个关系模式进行自然连接以后，总的属性的个数是减少了，具体减少的个数等于同名属性的个数"><a href="#！！！所以所两个关系模式进行自然连接以后，总的属性的个数是减少了，具体减少的个数等于同名属性的个数" class="headerlink" title="！！！所以所两个关系模式进行自然连接以后，总的属性的个数是减少了，具体减少的个数等于同名属性的个数"></a>！！！所以所两个关系模式进行自然连接以后，总的属性的个数是减少了，具体减少的个数等于同名属性的个数</h4></li>
</ul>
</blockquote>
</li>
<li><h3 id="theta连接-gt-是自然连接的扩展，相当于SQL中的join-on"><a href="#theta连接-gt-是自然连接的扩展，相当于SQL中的join-on" class="headerlink" title="theta连接==&gt;是自然连接的扩展，相当于SQL中的join on"></a>theta连接==&gt;是自然连接的扩展，相当于SQL中的join on</h3><ul>
<li><h4 id="格式：-关系-⋈Θ-关系"><a href="#格式：-关系-⋈Θ-关系" class="headerlink" title="格式：(关系)⋈Θ(关系)"></a>格式：(关系)⋈<sub>Θ</sub>(关系)</h4></li>
<li>形式化定义：<ul>
<li>r ⋈<sub>Θ</sub> s = σ<sub>Θ</sub>(r × s)</li>
</ul>
</li>
<li>举个栗子<ul>
<li>∏<sub>name, course_id</sub>(instructor ⋈<sub>instructor.ID = teaches.ID</sub> teaches)</li>
<li>上面的式子表示列出所有工资高于5000的老师的名字以及其所授课程的id， 等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">join</span> teaches <span class="keyword">on</span> instructor.ID = teaches.ID</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="除运算（division）"><a href="#除运算（division）" class="headerlink" title="除运算（division）"></a>除运算（division）</h3><blockquote>
<p>这个在书上没讲，是老师上课的时候补充的</p>
</blockquote>
<ul>
<li><h4 id="格式：-关系-÷-关系"><a href="#格式：-关系-÷-关系" class="headerlink" title="格式：(关系)÷(关系)"></a>格式：(关系)÷(关系)</h4></li>
<li>形式化定义：<br>R÷S = ∏<sub>R∪S</sub>( ( ∏<sub>R-S</sub>(r) × S ) - ∏<sub>R-S, S</sub>(r) )</li>
<li>笔者还有一篇介绍用SQL实现关系代数中除运算的文章=&gt;<a href="http://qjm253.cn/2018/05/04/2018-5-4-database-double-not-exists/">点我传送</a></li>
<li>解释起来挺麻烦的，这边给出一个博客链接：<a href="http://blog.csdn.net/qq_22627687/article/details/53789362" target="_blank" rel="noopener">点我传送</a></li>
</ul>
</li>
<li><h3 id="赋值运算"><a href="#赋值运算" class="headerlink" title="赋值运算"></a>赋值运算</h3><blockquote>
<p>就是将一个关系表达式的结果赋值取一个临时的名字，就相当于定义了一个临时关系。这个操作就相当于SQL中with语句的职能</p>
</blockquote>
<ul>
<li><h4 id="格式：-temp-name-←-关系表达式"><a href="#格式：-temp-name-←-关系表达式" class="headerlink" title="格式： temp_name ← 关系表达式"></a>格式： temp_name ← 关系表达式</h4></li>
<li>举个栗子：<br>temp1 ← R × S<br>temp2 ← σ<sub>r.A<sub>1</sub>=s.A<sub>1</sub> ∧ r.A<sub>2</sub>=s.A<sub>2</sub> ∧ … ∧ r.A<sub>n</sub>=s.A<sub>n</sub></sub>(temp1)<br>result = ∏<sub>R∪S</sub>(temp2)</li>
<li>上面的式子等价于： result = r⋈s</li>
</ul>
</li>
<li><h3 id="外连接运算"><a href="#外连接运算" class="headerlink" title="外连接运算"></a>外连接运算</h3><ul>
<li>左外连：⟕</li>
<li>右外连：⟖</li>
<li>全外连：⟗</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="扩展运算"><a href="#扩展运算" class="headerlink" title="扩展运算"></a>扩展运算</h2><p>扩展运算是不能用基本的关系代数运算来实现的一类查询，可以满足复杂的查询需求</p>
</blockquote>
<ul>
<li><h3 id="广义投影（Generalized-projection）"><a href="#广义投影（Generalized-projection）" class="headerlink" title="广义投影（Generalized-projection）"></a>广义投影（Generalized-projection）</h3><blockquote>
<p>与基本运算中的投影运算相比，就是多了允许在选择列表中出现表达式（在基本运算中的投影的选择列表中只能出现字段）</p>
</blockquote>
<ul>
<li><h4 id="格式：∏F1-F2-…-Fn-E"><a href="#格式：∏F1-F2-…-Fn-E" class="headerlink" title="格式：∏F1, F2, … , Fn(E)"></a>格式：∏<sub>F<sub>1</sub>, F<sub>2</sub>, … , F<sub>n</sub></sub>(E)</h4><ul>
<li>其中F<sub>1</sub>, F<sub>2</sub>, … , F<sub>n</sub>可以是字段或者是表达式</li>
<li>E代表一个关系</li>
</ul>
</li>
<li><p>举个栗子：</p>
<ul>
<li><p>∏<sub>name, sal * 1.2</sub>(instructor)</p>
</li>
<li><p>上面的式子表示查出所有老师的名字，以及涨了20%以后的工资，等价于下面的SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, sal * <span class="number">1.2</span></span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="聚集函数（Aggregation-function）"><a href="#聚集函数（Aggregation-function）" class="headerlink" title="聚集函数（Aggregation function）"></a>聚集函数（Aggregation function）</h3><blockquote>
<p>聚集函数的符号表示是用书写体G，这边就直接用G指代了</p>
<p><strong>聚集函数是输入值的一个汇聚，以多个值作为输入，将一个单一的值作为返回结果</strong></p>
<p>多重集：使用聚集函数对其进行操作的汇集中，一个值可以出现多次，值出现的顺序是无关紧要的。这样的汇集称为<strong>多重集</strong>（就比方说统计一个员工表中员工的数量，然后我们通过统计员工的名字来统计，即便是同名的员工我们也是计算的）</p>
</blockquote>
<ul>
<li><h4 id="格式：-G1-G2-…-GnGF1-A1-F2-A2-…-Fn-An-E"><a href="#格式：-G1-G2-…-GnGF1-A1-F2-A2-…-Fn-An-E" class="headerlink" title="格式： G1, G2, … , GnGF1(A1), F2(A2), …, Fn(An)(E)"></a>格式： <sub>G<sub>1</sub>, G<sub>2</sub>, … , G<sub>n</sub></sub>G<sub>F<sub>1</sub>(A<sub>1</sub>), F<sub>2</sub>(A<sub>2</sub>), …, F<sub>n</sub>(A<sub>n</sub>)</sub>(E)</h4><ul>
<li>其中前面的G<sub>1</sub>, G<sub>2</sub>, … , G<sub>n</sub>表示的是分组条件</li>
<li>后面的F<sub>1</sub>(A<sub>1</sub>), F<sub>2</sub>(A<sub>2</sub>), …, F<sub>n</sub>(A<sub>n</sub>)是聚集函数表达式列表</li>
<li>F<sub>i</sub>(i = 1, 2, …, n)表示聚集函数：sum、count、average、max、min</li>
<li>A<sub>1</sub>, A<sub>2</sub>, … , A<sub>n</sub>代表字段</li>
</ul>
</li>
<li><p>举个栗子：</p>
<ul>
<li><sub>A<sub>1</sub>, A<sub>2</sub></sub>G<sub>sum(A<sub>3</sub>)</sub>(∏<sub>A<sub>1</sub>, A<sub>2</sub>, …, A<sub>n</sub></sub>(σ<sub>P</sub>(r<sub>1</sub>×r<sub>2</sub>×…×r<sub>m</sub>)) )</li>
<li>等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A1, A2, <span class="keyword">sum</span>(A3)</span><br><span class="line"><span class="keyword">FROM</span> r1, r2, ..., rm</span><br><span class="line"><span class="keyword">WHERE</span> P</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A1, A2</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>上面的聚集函数在进行计算的时候采用的都是多重集，也就是相同的值可以多次重复计算（也就是在执行聚集函数的时候是不去重计算），如果要去重计算的话就要采用下面的几个函数写法</p>
<ul>
<li>sum_distinct</li>
<li>count_distinct</li>
<li>averag_distinct</li>
<li>max_distinct</li>
<li>min_distinct</li>
</ul>
</li>
<li>举个栗子：<ul>
<li><sub>A<sub>1</sub>, A<sub>2</sub></sub>G<sub>sum_distinct(A<sub>3</sub>)</sub>(∏<sub>A<sub>1</sub>, A<sub>2</sub>, …, A<sub>n</sub></sub>(σ<sub>P</sub>(r<sub>1</sub>×r<sub>2</sub>×…×r<sub>m</sub>)) )</li>
<li>上面的式子等价于下面的SQL语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A1, A2, <span class="keyword">sum</span>(<span class="keyword">distinct</span> A3)</span><br><span class="line"><span class="keyword">FROM</span> r1, r2, ..., rm</span><br><span class="line"><span class="keyword">WHERE</span> P</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A1, A2</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2017/10/15/2017-10-15-数据库笔记（九）——对违反约束的处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-r.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/15/2017-10-15-数据库笔记（九）——对违反约束的处理/" itemprop="url">数据库笔记（九）——对违反约束的处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-15T00:00:00+08:00">
                2017-10-15
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/15/2017-10-15-数据库笔记（九）——对违反约束的处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/15/2017-10-15-数据库笔记（九）——对违反约束的处理/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/15/2017-10-15-数据库笔记（九）——对违反约束的处理/" class="leancloud_visitors" data-flag-title="数据库笔记（九）——对违反约束的处理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>写在前面：本篇博客大部分内容参考数据库系统概念（本科教学版）第四章的一些尾巴，然后开始讲第六章的关系代数<br><strong><em>笔者接下来的代码示例会主要在SQL Server数据库中测试</em></strong></p>
</blockquote>
<hr>
<blockquote>
<p>在开始今天的摸鱼大业之前，让我们构造一些简单表</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行下面的语句构造表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> country(</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  country_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">  person_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> country(country_id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'China'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'English'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'America'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'Sunny'</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'Robbin'</span>, <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'Jane'</span>, <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h2><p>在指定外键以后，由于存在完整性约束，所以在执行删除或更新的时候由于语句可能会破坏完整性约束而执行失败。因此可以在定义外键的时候声明为级联删除和级联更新(<strong>是一种对违反参照完整性约束时的处理方式</strong>)</p>
</blockquote>
<ul>
<li><h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">table</span> 表名(</span><br><span class="line">  ...</span><br><span class="line">  FOREGIN <span class="keyword">KEY</span> (字段序列) <span class="keyword">REFERENCES</span> 表名(字段序列)</span><br><span class="line">      <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">      <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span>,</span><br><span class="line">  ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="级联删除（ON-DELETE-CASCADE）"><a href="#级联删除（ON-DELETE-CASCADE）" class="headerlink" title="级联删除（ON DELETE CASCADE）"></a>级联删除（ON DELETE CASCADE）</h3><ul>
<li>级联删除是在定义外键时指定的，但是却会在执行删除语句时产生影响</li>
<li><p>举个栗子</p>
<ul>
<li><p>我们先不指定级联</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> person;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> country;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> country(</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  country_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">  person_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> country(country_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'China'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'English'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'America'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'Sunny'</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'Robbin'</span>, <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'Jane'</span>, <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后执行下面的删除操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面我们试图删除中国的信息，但是在person表里有一条数据引用了中国，所以因为参照完整性约束的存在，所以这条语句会执行失败</span></span><br><span class="line"><span class="keyword">DELETE</span> country</span><br><span class="line"><span class="keyword">WHERE</span> country_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来我们重新构造一遍（当然直接用DDL语句更新也是可以的）–并在构造person表时指定了级联删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> person;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> country;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> country(</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  country_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">  person_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> country(country_id)</span><br><span class="line">      <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'China'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'English'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'America'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'Sunny'</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'Robbin'</span>, <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'Jane'</span>, <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后再次执行下面的删除操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 此时执行会发现语句成功执行了，不但删除了中国的信息，连带person表中引用了中国信息的所有数据都被删除了</span></span><br><span class="line"><span class="keyword">DELETE</span> country</span><br><span class="line"><span class="keyword">WHERE</span> country_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>上面的例子便很好的说明了级联删除的作用。如果我们视图删除外键参照键所在表（此处为country表）的某条数据A（此处是中国的信息），而这条数据又被外键所在表的一条或多条数据B所关联（此处person表中Sunny的country_id关联了country表中中国的id）。在指定了级联删除的情况下，删除A会连带着删除所有满足条件的B</p>
</li>
<li>当然在实际使用的时候用的还是比较少的，因为参照完整性约束在一定程度上可以防止数据的误删除，对数据库的完整性起了一定的保护作用，如果指定了级联删除，这层保护就失效了。所以还是视情况而用</li>
</ul>
</li>
<li><h3 id="级联更新（ON-UPDATE-CASCADE）"><a href="#级联更新（ON-UPDATE-CASCADE）" class="headerlink" title="级联更新（ON UPDATE CASCADE）"></a>级联更新（ON UPDATE CASCADE）</h3><ul>
<li>类似的，级联更新和级联删除一样，如果我们更新时违反了完整性约束，同样更新操作不被拒绝，而是级联更新</li>
<li><p>举个栗子（我们在上面操作的基础上执行，上面构造时指定了级联删除，但是没指定级联更新）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们试图执行下面的更新操作，我们把修改English的country_id， 但是由于person表中还有数据的country_id=2,如果下面的更新成功执行，则会导致person表中存在country_id=2的数据，而country中却没有对应数了，违反参照完整性约束，故下面的语句执行失败</span></span><br><span class="line"><span class="keyword">UPDATE</span> country</span><br><span class="line"><span class="keyword">SET</span> country_id = <span class="number">4</span></span><br><span class="line"><span class="keyword">WHERE</span> country_id = <span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>同样的，我们重新构造一下，此时指定级联更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> person;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> country;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> country(</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  country_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">  person_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> country(country_id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'China'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'English'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'America'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'Sunny'</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'Robbin'</span>, <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'Jane'</span>, <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时再执行一下上面的更新语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 由于指定了级联更新，所以会发现下面的语句执行成功了，不但更改了country表中的数据，连带着person表中的数据也一并更新了</span></span><br><span class="line"><span class="keyword">UPDATE</span> country</span><br><span class="line"><span class="keyword">SET</span> country_id = <span class="number">4</span></span><br><span class="line"><span class="keyword">WHERE</span> country_id = <span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上面就是级联更新的效果</p>
</li>
</ul>
</li>
<li><h3 id="另一类对违反完整性约束的处理"><a href="#另一类对违反完整性约束的处理" class="headerlink" title="另一类对违反完整性约束的处理"></a>另一类对违反完整性约束的处理</h3><ul>
<li>SET DEFAULT<ul>
<li>一旦违反完整性约束，就将参照域（此处为country_id）设置为默认值</li>
</ul>
</li>
<li>SET NULL<ul>
<li>一旦违反完整性约束，就将参照域（此处为country_id）设置为NULL</li>
</ul>
</li>
<li><p>举个栗子</p>
<ul>
<li><p>执行下面的构造</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> person;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> country;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> country(</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  country_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">  person_id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  country_id <span class="built_in">INTEGER</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> country(country_id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'China'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'English'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'America'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">1</span>, <span class="string">'Sunny'</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">2</span>, <span class="string">'Robbin'</span>, <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">3</span>, <span class="string">'Jane'</span>, <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后执行下面的删除操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的删除操作成功执行，但不是级联删除，而是把person表中原来country_id=1的数据的country_id都设成了NULL</span></span><br><span class="line"><span class="keyword">DELETE</span> country</span><br><span class="line"><span class="keyword">WHERE</span> country_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="延迟检查"><a href="#延迟检查" class="headerlink" title="延迟检查"></a>延迟检查</h2><p>这是由于数据库默认是在执行每一条SQL语句的时候都进行完整性约束的检查，导致有些操作无法进行。延迟操作就将完整性约束的检查延迟到了事务结束的时候检查（大多数数据库不支持，比如SQL Server， 但Oracle数据支持）</p>
</blockquote>
<ul>
<li><p>由于不常用，SQL Server也不支持，这里就讲一下概念，不举实际的栗子了。</p>
</li>
<li><p>假设上面的例子表中没有指定延迟检查</p>
<ul>
<li>执行下面的语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行下面两条语句是会出错的，因为插入第一条数据的时候，由于完整性约束的存在，要求country表中要有country_id=4的数据，但是这个数据目前还不存在（所以只要先执行第二条语句，这两个语句才能成功执行）</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">4</span>, <span class="string">'Jerry'</span>, <span class="number">4</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">4</span>, <span class="string">'France'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>而如果指定了延迟检查呢</p>
<ul>
<li>执行下面语句（下面两个语句处于同一个事务中）<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 由于是延迟检查，所以两条数据都插入完，执行commit，事务结束时才进行完整性约束的检查，此时就不会出错，可以正常插入</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person (person_id, <span class="keyword">name</span>, country_id) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">4</span>, <span class="string">'Jerry'</span>, <span class="number">4</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> country (country_id, country_name) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">4</span>, <span class="string">'France'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">COMMIT</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>虽然SQL标准中有这个概念，但是大多数数据库没有提供支持，并且不常用</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2017/10/10/2017-10-10-数据库学习笔记（八）——视图 、事务 /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-r.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/10/2017-10-10-数据库学习笔记（八）——视图 、事务 /" itemprop="url">数据库笔记（八）——视图 、事务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-10T00:00:00+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/10/2017-10-10-数据库学习笔记（八）——视图 、事务 /#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/10/2017-10-10-数据库学习笔记（八）——视图 、事务 /" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/10/2017-10-10-数据库学习笔记（八）——视图 、事务 /" class="leancloud_visitors" data-flag-title="数据库笔记（八）——视图 、事务">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>写在前面：本篇博客大部分内容参考数据库系统概念（本科教学版）第四章(第三章的多表部分会挪到这一部分讲)<br><strong><em>笔者接下来的代码示例会主要在SQL Server数据库中测试</em></strong></p>
</blockquote>
<hr>
<blockquote>
<p>在开始今天的摸鱼大业之前，让我们继续延用之前用的表(´`)</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-0efdf4c14fc38de4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="BONUS.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-1d0cfd97cfff8f86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DEPT.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-92e8199e3c0a7042.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="EMP.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-aa04e988d03f7215.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SALGRADE.png"></p>
<blockquote>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>首先还是来谈谈笔者对视图概念的理解吧，在笔者看来视图这个数据库对象在不考虑物化的情况下就是一张虚表，本身没有实际的数据，但是可以利用视图在某个视角下观察一张或多张表的数据。所有对视图的操作最后都将转成对表的操作</p>
</blockquote>
<ul>
<li><h3 id="视图定义（创建一个视图）"><a href="#视图定义（创建一个视图）" class="headerlink" title="视图定义（创建一个视图）"></a>视图定义（创建一个视图）</h3><ul>
<li><p>格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名 <span class="keyword">AS</span> 子查询</span><br></pre></td></tr></table></figure>
</li>
<li><p>举个栗子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的语句创建了一个简单的视图temp_view，其中包含员工名以及其所在部门名两个字段</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> temp_view <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO;</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来我们对上面创建的视图进行查询操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> temp_view;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-38a3660b5d475096.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p>
</li>
<li><h3 id="数据库只存储视图的定义本身"><a href="#数据库只存储视图的定义本身" class="headerlink" title="数据库只存储视图的定义本身"></a>数据库只存储视图的定义本身</h3><ul>
<li>视图通常是这样来实现的：当我们定义一个视图的时候，数据库系统就吧<strong><em>这个视图的定义（其实就是一个子查询语句）</em></strong>本身存储下来，一旦我们使用这个视图，数据库系统就会用定义中的查询语句替换视图</li>
<li>举个栗子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们继续沿用上面定义的视图temp_view，它的定义是这样的</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> temp_view <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 则对视图的查询操作可以作下面的等价(下面两个查询语句是等价的)</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> temp_view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO) <span class="keyword">as</span> temp_view;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h3 id="可更新的视图"><a href="#可更新的视图" class="headerlink" title="可更新的视图"></a>可更新的视图</h3><ul>
<li><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><ol>
<li>FROM子句中只有一个数据库关系（<strong><em>即在定义视图的时候，后面的SELECT语句中只能查询一个表</em></strong>）</li>
</ol>
<ul>
<li>SELECT子句中只包含关系的属性名，不包含任何的表达式，集聚函数或distinct声明</li>
<li>任何没有出现在SELECT子句中的属性可以取空值（<strong><em>即这些属性既没有not null 约束，也不构成主码的一部分</em></strong>）</li>
<li>查询中不含有group by 或 having 子句</li>
</ul>
</li>
<li><h4 id="满足上述条件的视图我们称作可更新的视图，在可更新视图上允许执行update、insert、delete操作"><a href="#满足上述条件的视图我们称作可更新的视图，在可更新视图上允许执行update、insert、delete操作" class="headerlink" title="满足上述条件的视图我们称作可更新的视图，在可更新视图上允许执行update、insert、delete操作"></a>满足上述条件的视图我们称作可更新的视图，在可更新视图上允许执行<strong>update、insert、delete</strong>操作</h4></li>
<li><h4 id="视图是在表的基础上定义的，所有对视图的操作最后都将作用在表上"><a href="#视图是在表的基础上定义的，所有对视图的操作最后都将作用在表上" class="headerlink" title="视图是在表的基础上定义的，所有对视图的操作最后都将作用在表上"></a>视图是在表的基础上定义的，所有对视图的操作最后都将作用在表上</h4></li>
</ul>
</li>
<li><h3 id="视图的update、insert、delete"><a href="#视图的update、insert、delete" class="headerlink" title="视图的update、insert、delete"></a>视图的update、insert、delete</h3><ul>
<li><p>先定义一个视图，值包括员工的职工号、名字和工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_info <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPNO, ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP;</span><br></pre></td></tr></table></figure>
<p>视图查询的结果如下：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-3f0d770579621459.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p>
</li>
<li><h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><ul>
<li>举个栗子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的语句更新SMITH的工资</span></span><br><span class="line"><span class="keyword">UPDATE</span> emp_info</span><br><span class="line"><span class="keyword">SET</span> SAL = <span class="number">900</span></span><br><span class="line"><span class="keyword">WHERE</span> ENAME = <span class="string">'SMITH'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--接下来查询表中的数据是否受到影响（查询的结果是900，就不贴图了）</span></span><br><span class="line"><span class="keyword">SELECT</span> ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> ENAME = <span class="string">'SMITH'</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><ul>
<li>举个栗子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 往视图中插入一条数据（下面插入是可以执行成功的，可以自己试试，创建一个视图，只包含员工名字和工资，不包含EMPNO，这样就不能执行插入语句，违反了上面四个条件中的第三个条件）</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp_info (EMPNO, ENAME, SAL) <span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="number">8888</span>, <span class="string">'Robbin'</span>, <span class="string">'1000'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>–查询一下原表中的数据，会发现多了下面这条<br><img src="http://upload-images.jianshu.io/upload_images/7222676-2d5ffd3369ef3630.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p>
<ul>
<li>视图的插入操作，最终作用到表上，并且是给视图中有的字段赋值，没有的字段都赋null值（这就解释了上面可更新视图的四个条件中的条件3）</li>
</ul>
</li>
<li><h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><ul>
<li>举个栗子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行结果就是原表中的数据也被删除了</span></span><br><span class="line"><span class="keyword">DELETE</span> emp_info</span><br><span class="line"><span class="keyword">WHERE</span> emp_info.EMPNO = <span class="number">8888</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="物化视图"><a href="#物化视图" class="headerlink" title="物化视图"></a>物化视图</h3><ul>
<li>就是保存视图的结构，再使用时直接用保存的结果表，而不用再去将视图替换成定义，再次执行一遍查询视图的操作。这个在对视图的操作很频繁的时候是对效率很有增益的，但是同时带来的是同步的问题。就是原表中的数据更新了，但是视图物化的数据却没有更新，导致数据不一致。</li>
<li>一般用的很少，常用于数据仓库</li>
</ul>
</li>
<li><h3 id="视图更新检查（WITH-CHECK-OPTION）"><a href="#视图更新检查（WITH-CHECK-OPTION）" class="headerlink" title="视图更新检查（WITH CHECK OPTION）"></a>视图更新检查（<strong>WITH CHECK OPTION</strong>）</h3><ul>
<li>默认情况下，如果一个视图满足以上可更新视图的定义，则通常的更新操作是允许被执行的</li>
<li>但是如果在创建视图的时候，在后面跟上 <strong>WITH CHECK OPTION</strong>,那么对视图的每一个更新操作，都会检查，更改后的结果，是否满足创建视图时WHERE子句中的限定。</li>
<li><p>举个栗子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们在上面定义视图的栗子基础上改造一下，并加上WITH CHECK OPTION</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_info <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPNO, ENAME, SAL</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt; <span class="number">3000</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>上面视图的定义就是包含了工资超过3000的所有员工的员工号，名字，以及工资</li>
<li><p>这个时候如果我们执行下面的更新操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面这个操作将会被拒绝执行</span></span><br><span class="line"><span class="keyword">UPDATE</span> emp_info</span><br><span class="line"><span class="keyword">SET</span> SAL = <span class="number">2000</span></span><br><span class="line"><span class="keyword">WHERE</span> ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于在定义视图的时候添加了 <strong>WITH CHEKC OPTION</strong> 选项，所以在执行更新操作的时候回检查是否符合创建视图时WHERE子句中的条件，显然上面的操作不满足，故被拒绝执行。</p>
<blockquote>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2></blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>一个事务就是一个原子的，不可分割的任务，里面可能包含多条SQL语句。在事务机制下，一个事务中的多条SQL语句要么都执行，要么都不执行。</p>
</li>
<li><h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><ul>
<li>原子性<ul>
<li>事务是原子的，里面包含的一条或多条SQL语句要么都执行，要么都不执行</li>
</ul>
</li>
<li>一致性<ul>
<li>在隔离的执行多个事务时，用同步锁保证对数据库数据的一致性访问</li>
</ul>
</li>
<li>隔离性<ul>
<li>多个事务并行执行，若其中一个事务还没有结束，其他事务内是无法观察到这个事务对数据库的影响的</li>
</ul>
</li>
<li>持久性<ul>
<li>一旦事务正常完成，并提交，则其对数据库的修改就会持久化到数据库内。</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="事务的开始和终止"><a href="#事务的开始和终止" class="headerlink" title="事务的开始和终止"></a>事务的开始和终止</h3><ul>
<li>虽然各种关系型数据库都支持事务，但是不同的数据库的实现不同。具体的事务的开始和终止有隐式和显示之分</li>
<li><h4 id="事务的开始"><a href="#事务的开始" class="headerlink" title="事务的开始"></a>事务的开始</h4><ul>
<li>显示：begin transition （例如SQL Server数据库）</li>
<li>隐式：第一条DML语句（增删改查语句）开始执行就会开启一个事务 （例如Oracle数据库）</li>
</ul>
</li>
<li><h4 id="事物的终止"><a href="#事物的终止" class="headerlink" title="事物的终止"></a>事物的终止</h4><ul>
<li>显示： end transition  (例如SQL Server数据库)</li>
<li>隐式：执行 rollback、commit或者一条DDL语句  （例如Oracle数据库）</li>
</ul>
</li>
</ul>
</li>
<li><h3 id="数据库加锁的范围不同"><a href="#数据库加锁的范围不同" class="headerlink" title="数据库加锁的范围不同"></a>数据库加锁的范围不同</h3><ul>
<li>表级锁</li>
<li>页级锁</li>
<li>行级锁</li>
</ul>
</li>
<li><h3 id="举个栗子-由于使用SQL-Server做的测试，所以采用显示的事务开启和关闭"><a href="#举个栗子-由于使用SQL-Server做的测试，所以采用显示的事务开启和关闭" class="headerlink" title="举个栗子(由于使用SQL Server做的测试，所以采用显示的事务开启和关闭)"></a>举个栗子(由于使用SQL Server做的测试，所以采用显示的事务开启和关闭)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先查看博客开头ALLEN的工资是1600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面开启一个事务，并执行一条涨工资的操作（执行会立即完成）</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> EMP <span class="keyword">SET</span> SAL = SAL * <span class="number">2</span></span><br><span class="line"><span class="keyword">WHERE</span> ENAME = <span class="string">'ALLEN'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 与此同时，开启另一个事务，执行一条涨工资的操作（语句没有执行，一直在等待。这是因为上面那个事务对ALLEN的数据进行操作了，并且事务没有结束，由于同步锁的缘故，所以本事务中的修改语句要等上面那个事务执行完才能继续执行）</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> EMP <span class="keyword">SET</span> SAL = SAL * <span class="number">3</span></span><br><span class="line"><span class="keyword">WHERE</span> ENAME = <span class="string">'ALLEN'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果此时结束第一个事务，那么第二个事务的语句就能继续执行，此时提交第二个事务，最后得到的结果是，ALLEN的工资为9600</span></span><br><span class="line"><span class="keyword">COMMIT</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h2 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h2></blockquote>
<ul>
<li><h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3></li>
<li><h3 id="外键约束（参照完整性约束）"><a href="#外键约束（参照完整性约束）" class="headerlink" title="外键约束（参照完整性约束）"></a>外键约束（参照完整性约束）</h3></li>
<li><h3 id="单关系上的约束"><a href="#单关系上的约束" class="headerlink" title="单关系上的约束"></a>单关系上的约束</h3><ul>
<li>not null</li>
<li>unique</li>
<li>check(&lt;谓词&gt;)</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2017/09/29/2017-09-29-数据库学习笔记（七）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar-r.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/29/2017-09-29-数据库学习笔记（七）/" itemprop="url">数据库笔记（七）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-29T00:00:00+08:00">
                2017-09-29
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/29/2017-09-29-数据库学习笔记（七）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/09/29/2017-09-29-数据库学习笔记（七）/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/09/29/2017-09-29-数据库学习笔记（七）/" class="leancloud_visitors" data-flag-title="数据库笔记（七）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>写在前面：本篇博客大部分内容参考数据库系统概念（本科教学版）第四章(第三章的多表部分会挪到这一部分讲)<br><strong><em>笔者接下来的代码示例会主要在SQL Server数据库中测试(由于SQL Server 数据库不支持自然连接，所以自然连接部分的将会在MySQL数据库中进行测试)</em></strong></p>
</blockquote>
<hr>
<blockquote>
<p>在开始今天的摸鱼大业之前，让我们继续延用之前用的表</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-0efdf4c14fc38de4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="BONUS.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-1d0cfd97cfff8f86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DEPT.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-92e8199e3c0a7042.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="EMP.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7222676-aa04e988d03f7215.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SALGRADE.png"></p>
<blockquote>
<p>外键约束：即具有外键约束的两张表，在进行操作时会收到一定程度的限制，如果某个操作执行后会破坏这个完整性，就将被拒绝执行。这个在之前的博客中有介绍==&gt;<a href="http://www.jianshu.com/p/6f5032194eab" target="_blank" rel="noopener"> 传送门</a></p>
</blockquote>
<hr>
<blockquote>
<h2 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h2><p>一个表与自身相连接的操作，其实与多表连接是一样的，只是连接的两张表用的是同一张表而已</p>
</blockquote>
<ul>
<li><h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的语句查询了所有员工的名字以及其经理的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> w.ENAME <span class="keyword">as</span> worker_name, m.ENAME <span class="keyword">as</span> manager_name</span><br><span class="line"><span class="keyword">FROM</span> EMP w</span><br><span class="line">  <span class="keyword">JOIN</span> EMP m <span class="keyword">ON</span> w.MGR = m.EMPNO;</span><br></pre></td></tr></table></figure>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-6b77b742a7e84c86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p>
</li>
<li>上面得到的结果是采用内连接得到的结果，所以对于那些MGR为null（没有经理）的员工，其信息就得不到显示，可以采用左外连接（LEFT OUTER JOIN）</li>
<li><p>员工表中MGR 和 EMPNO 字段应该有一层限制，MGR的取值应该是某一个EMPNO的取值（话句话说，一个员工的经理号应该也是同一张表中这个经理的职工号）。在定义这张表的时候可以给这两个字段加上一个外键约束。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--下面的语句模拟了这一操作</span></span><br><span class="line"><span class="comment">--只关注了EMPNO和MGR这两个字段，其他字段的描述省略了</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> EMP(</span><br><span class="line">  EMPNO <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">  MGR <span class="built_in">INTEGER</span>,</span><br><span class="line">  ....</span><br><span class="line">  FOREIGN <span class="keyword">KEY</span>(MGR) <span class="keyword">REFERENCES</span> EMP(EMPNO)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>还是那句话：<strong>绝大多数连接条件是建立在外键与外键的参照键之间的</strong>(自连接也不例外)</p>
</li>
</ul>
<blockquote>
<h2 id="自然连接（NATURAL-JOIN）"><a href="#自然连接（NATURAL-JOIN）" class="headerlink" title="自然连接（NATURAL JOIN）"></a>自然连接（NATURAL JOIN）</h2><p>其实自然连接就是写法更简单的多表连接，无需书写连接条件，让数据库自己判断应该采用什么连接条件（自然连接的语法是SQL的标准语法，但是并不是所有的数据库都支持，SQL Server就不支持自然连接的语法，但是Oracle和MySQL数据库都是支持的。。<strong>所以下面的测试就在MySQL里面测试啦，上次用IDEA连的那个数据库里面我已经建好了和在上面测试用例一样的表和数据，可以直接用</strong>）</p>
</blockquote>
<ul>
<li><h3 id="可采用自然连接的前提条件：两个表中要有同名字段，并且同名字段的数据类型要一致"><a href="#可采用自然连接的前提条件：两个表中要有同名字段，并且同名字段的数据类型要一致" class="headerlink" title="可采用自然连接的前提条件：两个表中要有同名字段，并且同名字段的数据类型要一致"></a>可采用自然连接的前提条件：<strong><em>两个表中要有同名字段，并且同名字段的数据类型要一致</em></strong></h3><ul>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的语句就实现了查询所有的员工名字及其所在部门名</span></span><br><span class="line"><span class="comment">-- 相当于内连接</span></span><br><span class="line"><span class="comment">-- 因为两个表中有同名字段DEPTNO，并且数据类型相同，数据库就用这个作为连接条件</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> DEPT d;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 上面的语句等价于下面的内连接语句</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO;</span><br></pre></td></tr></table></figure>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-c9b92501a39f2897.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p>
</li>
<li>如果两个表中有同名字段，但是数据类型不一致，执行自然连接是会失败的，因为此时数据库不知道应该怎么连接两张表</li>
</ul>
</li>
<li><h3 id="当然如果想要执行外连接（左外，右外，全外）也是一样的"><a href="#当然如果想要执行外连接（左外，右外，全外）也是一样的" class="headerlink" title="当然如果想要执行外连接（左外，右外，全外）也是一样的"></a>当然如果想要执行外连接（左外，右外，全外）也是一样的</h3><ul>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面几个语句是等价的，会得到相同的结果，都采用了左外连接</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> DEPT d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> DEPT d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> DEPT d <span class="keyword">ON</span> e.DEPTNO = d.DEPTNO;</span><br></pre></td></tr></table></figure>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-c65af46549b6e705.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p>
</li>
</ul>
</li>
<li><h3 id="在使用自然连接时，同名字段（用于连接的字段）不能写限定名（虽然老师上课这么讲，但实际上呢？）"><a href="#在使用自然连接时，同名字段（用于连接的字段）不能写限定名（虽然老师上课这么讲，但实际上呢？）" class="headerlink" title="在使用自然连接时，同名字段（用于连接的字段）不能写限定名（虽然老师上课这么讲，但实际上呢？）"></a>在使用自然连接时，同名字段（用于连接的字段）不能写限定名（虽然老师上课这么讲，但实际上呢？）</h3><ul>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们在上面例子的基础上，多显示一个部门号，下面的两条语句如果能执行，执行完的结果都是一样的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的语句在Oracle数据库执行会报错</span></span><br><span class="line"><span class="comment">-- 但是在MySQL中执行是能过的</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME, e.DEPTNO</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> DEPT d;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面这种写法在Oracle和MySQL中都是能过的</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME, DEPTNO</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> DEPT d;</span><br></pre></td></tr></table></figure>
</li>
<li><p>让我们先分析一下，为什么在使用自然连接的时候同名字段可以不写限定名</p>
<ul>
<li><p>先看看执行下面的语句有什么结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> DEPT d;</span><br></pre></td></tr></table></figure>
<p>得到下面结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-24eeb8dd9e7220e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p>
</li>
<li>可以看出来，采用自然连接以后，原本的同名字段DEPTNO只出现了一次,可以理解为采用自然连接以后FROM子句的结果就是上面那张表，同时原来的同名字段合成了一个。所以在SELECT子句中书写的时候可以不加表限定名（在Oracle数据库中不能加表限定名）</li>
<li><strong>对比join操作</strong>，如果你直接用内连接或者外连接，而不是自然连接，会发现结果集里面用来连接的字段即便同名，也是会出现两次的（<strong>这也很好的解释了，为什么之前说在进行内外连操作的时候，用来连接的字段是需要用表明来限定的，不然SQL语句会有歧义，导致无法正确被解析</strong>————见数据库笔记（六））<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 你可以试试执行下面的SQL语句，会发现，结果集中名为DEPTNO的列有两列</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> DEPT d <span class="keyword">on</span> e.DEPTNO = d.DEPTNO;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>让我们对上面的结果小结一下</p>
<ul>
<li>在采用自然连接的时候，对于同名字段，可以不写表限定名（<strong>但是在使用非自然连接的时候，同名字段一定要用表名来限定</strong>）</li>
<li>至于能不能写，得看具体是什么数据库，Oracle此种情况下就不允许在同名字段前写表限定名，而MySQL中则可以</li>
<li>所以推荐是在<strong>采用自然连接的时候</strong>，<strong>非同名字段都加上限定名，同名字段都不加</strong></li>
</ul>
</li>
</ul>
</li>
<li><h3 id="下面是在多表操作中的一点建议"><a href="#下面是在多表操作中的一点建议" class="headerlink" title="下面是在多表操作中的一点建议"></a>下面是在多表操作中的一点建议</h3><ul>
<li>在多表连接中，所有的字段前面都建议加上限定名</li>
<li>特殊的是，在使用自然连接的时候，同名字段不要写限定名</li>
</ul>
</li>
<li><h3 id="有一个问题就是，由于数据库只分析到数据字典层面，而无法分到数据层，所以就算两个表中的一组同名字段之间没有任何关系，但是数据类型一致，采用自然连接的话，这一组同名字段也会被作为连接条件。"><a href="#有一个问题就是，由于数据库只分析到数据字典层面，而无法分到数据层，所以就算两个表中的一组同名字段之间没有任何关系，但是数据类型一致，采用自然连接的话，这一组同名字段也会被作为连接条件。" class="headerlink" title="有一个问题就是，由于数据库只分析到数据字典层面，而无法分到数据层，所以就算两个表中的一组同名字段之间没有任何关系，但是数据类型一致，采用自然连接的话，这一组同名字段也会被作为连接条件。"></a>有一个问题就是，由于数据库只分析到数据字典层面，而无法分到数据层，所以就算两个表中的一组同名字段之间没有任何关系，但是数据类型一致，采用自然连接的话，这一组同名字段也会被作为连接条件。</h3><ul>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--下面这个栗子没有实际执行，想象一下就好</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设我们给部门表的部门名字段更名：DNAME--&gt;ENAME</span></span><br><span class="line"><span class="comment">-- 然后我们仍然执行上面的例子</span></span><br><span class="line"><span class="comment">-- 结果应该是没有数据，除非有一个员工，他的名字和他所在部门的名字是一样的。</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.ENMAE</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> DEPT d</span><br></pre></td></tr></table></figure>
</li>
<li><p>导致上面结果的原因是采用了自然连接以后，数据库会把所有同名并且类型相同的字段作为连接条件</p>
</li>
<li>有时候我们并不希望所有的同名字段都作为条件，这个时候我们就不能用上面的自然连接操作，就应该使用介绍的有关JOIN … USING的用法</li>
</ul>
</li>
<li><h3 id="利用JOIN-…-USING-可以灵活的指定用什么字段做连接条件"><a href="#利用JOIN-…-USING-可以灵活的指定用什么字段做连接条件" class="headerlink" title="利用JOIN … USING 可以灵活的指定用什么字段做连接条件"></a>利用JOIN … USING 可以灵活的指定用什么字段做连接条件</h3><ul>
<li>JOIN…USING 同样是一种自然连接，且是一种特殊的自然连接，不需要显示写明连接条件，只需要指定用什么字段连接即可</li>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用下面的语句同样可以实现查询所有员工名字以及其所在部门名字的需求</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.DNAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">JOIN</span> DEPT d <span class="keyword">USING</span> (DEPTNO);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 同样的，如果我们给部门表的部门名字段更名：DNAME--&gt;ENAME</span></span><br><span class="line"><span class="comment">-- 为了避免上面提到的问题，我们可以只指定DEPTNO作为连接条件，就轻松解决上面的问题</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, d.ENAME</span><br><span class="line"><span class="keyword">FROM</span> EMP e</span><br><span class="line">  <span class="keyword">JOIN</span> DEPT d <span class="keyword">USING</span> (DEPTNO);</span><br></pre></td></tr></table></figure>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-22a77fd9ef19119d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p>
</li>
<li>其中<strong>JOIN 表名 USING (字段序列)</strong>，字段序列可以是一个或多个字段</li>
</ul>
</li>
<li><h3 id="如果两个表中存在同名字段，但是数据类型不一样，这样执行自然连接是会失败的"><a href="#如果两个表中存在同名字段，但是数据类型不一样，这样执行自然连接是会失败的" class="headerlink" title="如果两个表中存在同名字段，但是数据类型不一样，这样执行自然连接是会失败的"></a>如果两个表中存在同名字段，但是数据类型不一样，这样执行自然连接是会失败的</h3></li>
<li><h3 id="连接类型和连接条件-就是老师上课提到的课本上那个图"><a href="#连接类型和连接条件-就是老师上课提到的课本上那个图" class="headerlink" title="连接类型和连接条件(就是老师上课提到的课本上那个图)"></a>连接类型和连接条件(就是老师上课提到的课本上那个图)</h3><ul>
<li><h4 id="连接类型"><a href="#连接类型" class="headerlink" title="连接类型"></a>连接类型</h4><ul>
<li>INNER JOIN</li>
<li>LEFT OUTER JOIN</li>
<li>RIGHT OUTER JOIN</li>
<li>FULL OUTER JOIN</li>
</ul>
</li>
<li><h4 id="连接条件"><a href="#连接条件" class="headerlink" title="连接条件"></a>连接条件</h4><ul>
<li>NATURAL</li>
<li>ON&lt; predicate></li>
<li>USING(A1, A2, …, An)</li>
</ul>
</li>
<li>其中上面的连接类型和连接条件可以任意组合使用</li>
<li>但不是所有数据库都支持NATURAL 和 USING的用法，SQL Server不支持，Oracle和MySQL支持，即便支持，有一些细节还是不一样的（比如上面同名字段前面能不能加限定词的问题）</li>
<li>ON的话是都支持的，建议用ON，有更好的可读性和灵活性</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="FROM子句中的子查询"><a href="#FROM子句中的子查询" class="headerlink" title="FROM子句中的子查询"></a>FROM子句中的子查询</h2></blockquote>
<ul>
<li><h3 id="如果子查询出现在FROM子句中，我们将子查询的结果当做一个临时的关系（表），奕称之为虚表"><a href="#如果子查询出现在FROM子句中，我们将子查询的结果当做一个临时的关系（表），奕称之为虚表" class="headerlink" title="如果子查询出现在FROM子句中，我们将子查询的结果当做一个临时的关系（表），奕称之为虚表"></a>如果子查询出现在FROM子句中，我们将子查询的结果当做一个临时的关系（表），奕称之为虚表</h3><ul>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的例子求出了工资比本部门平均工资高的员工的名字和其工资，以及其所在部门的平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, e.SAL, E.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> EMP e, (<span class="keyword">SELECT</span> DEPTNO, <span class="keyword">AVG</span>(SAL) <span class="keyword">as</span> avg_sal</span><br><span class="line">      <span class="keyword">FROM</span> EMP</span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO) <span class="keyword">as</span> E</span><br><span class="line"><span class="keyword">WHERE</span> e.DEPTNO = E.DEPTNO <span class="keyword">and</span> e.SAL &gt; avg_sal;</span><br></pre></td></tr></table></figure>
<p>得到如下结果：<br><br><img src="http://upload-images.jianshu.io/upload_images/7222676-7ba5a1d249d51f88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p>
</li>
<li>分析上面的执行过程的时候，可以先分析一下子查询执行的结果是什么，然后再把它当做一张表放在上面，继续分析整个语句</li>
</ul>
</li>
<li><h3 id="可以给子查询得到的临时表取一个名字，并给里面的每个字段指定名字"><a href="#可以给子查询得到的临时表取一个名字，并给里面的每个字段指定名字" class="headerlink" title="可以给子查询得到的临时表取一个名字，并给里面的每个字段指定名字"></a>可以给子查询得到的临时表取一个名字，并给里面的每个字段指定名字</h3><ul>
<li><p>最常见的是下面这种命名方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.ENAME, e.SAL, E.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> EMP e, (<span class="keyword">SELECT</span> DEPTNO, <span class="keyword">AVG</span>(SAL)</span><br><span class="line">      <span class="keyword">FROM</span> EMP</span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO) <span class="keyword">as</span> E(DEPTNO, avg_sal)</span><br><span class="line"><span class="keyword">WHERE</span> e.DEPTNO = E.DEPTNO <span class="keyword">and</span> e.SAL &gt; avg_sal;</span><br></pre></td></tr></table></figure>
<ul>
<li>直接在子查询后面用as关系指定表名以及子查询结果中每个字段的别名</li>
</ul>
</li>
<li><p>但是也不是所有数据库都支持上面那种用法，Oracle数据库中就不支持用as关键字指定子查询的表名，也不支持在表名后面加上每个字段的名字，那这个时候怎么办呢？（<strong>可以在子查询里面给每个字段取别名，最后再给子查询得到的虚表用空格分隔取个表名就好了</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.ENAME, e.SAL, E.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> EMP e, (<span class="keyword">SELECT</span> DEPTNO, <span class="keyword">AVG</span>(SAL) <span class="keyword">as</span> avg_sal</span><br><span class="line">      <span class="keyword">FROM</span> EMP</span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO) E</span><br><span class="line"><span class="keyword">WHERE</span> e.DEPTNO = E.DEPTNO <span class="keyword">and</span> e.SAL &gt; avg_sal;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>下面提几点注意（对于FROM子句中的子查询）</strong>：</p>
<ul>
<li>如果子查询中含有聚集函数（组函数）,一定要给它起个别名</li>
<li>对每个子查询得到的虚表都务必取个表名（虽然有些数据库可以不起表名，但是有些数据库不起表名是会出错的，所以建议还是都起一个表名）</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="With-子句"><a href="#With-子句" class="headerlink" title="With 子句"></a>With 子句</h2><p>其实with子句的作用和在FROM子句中使用子查询时一样的，同样是得到了一张虚表，只是把FROM中冗长的子查询移到外面，可读性 更好一点</p>
</blockquote>
<ul>
<li><h3 id="with子句的作用是定义一张临时表"><a href="#with子句的作用是定义一张临时表" class="headerlink" title="with子句的作用是定义一张临时表"></a>with子句的作用是定义一张临时表</h3></li>
<li><h3 id="WITH子句相当于把FROM中的子查询提出来，如果FROM子句中的子查询比较复杂的时候，这样做是很有好处的，可读性会好很多"><a href="#WITH子句相当于把FROM中的子查询提出来，如果FROM子句中的子查询比较复杂的时候，这样做是很有好处的，可读性会好很多" class="headerlink" title="WITH子句相当于把FROM中的子查询提出来，如果FROM子句中的子查询比较复杂的时候，这样做是很有好处的，可读性会好很多"></a>WITH子句相当于把FROM中的子查询提出来，如果FROM子句中的子查询比较复杂的时候，这样做是很有好处的，可读性会好很多</h3></li>
<li><h3 id="WITH-的基本使用方法"><a href="#WITH-的基本使用方法" class="headerlink" title="WITH 的基本使用方法"></a>WITH 的基本使用方法</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WITH &lt; 临时表名 &gt; （字段别名序列）AS (子查询)</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="举个栗子-1"><a href="#举个栗子-1" class="headerlink" title="举个栗子"></a>举个栗子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的例子和上面找大于本部门平均工资的例子是等效的</span></span><br><span class="line"><span class="comment">-- 执行的结果也是相同的</span></span><br><span class="line">WITH avg_tab(DEPTNO, avg_sal)</span><br><span class="line">AS (<span class="keyword">SELECT</span> DEPTNO, <span class="keyword">AVG</span>(SAL)</span><br><span class="line">    <span class="keyword">FROM</span> EMP</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO)</span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, e.SAL, avg_tab.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> EMP e, avg_tab</span><br><span class="line"><span class="keyword">WHERE</span> e.DEPTNO = avg_tab.DEPTNO <span class="keyword">AND</span> e.SAL &gt; avg_tab.avg_sal;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的语句和上面的等效</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ENAME, e.SAL, E.avg_sal</span><br><span class="line"><span class="keyword">FROM</span> EMP e, (<span class="keyword">SELECT</span> DEPTNO, <span class="keyword">AVG</span>(SAL)</span><br><span class="line">      <span class="keyword">FROM</span> EMP</span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO) <span class="keyword">as</span> E(DEPTNO, avg_sal)</span><br><span class="line"><span class="keyword">WHERE</span> e.DEPTNO = E.DEPTNO <span class="keyword">and</span> e.SAL &gt; avg_sal;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h2 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h2></blockquote>
<ul>
<li><h3 id="把子查询的结果当做一个值，可以出现在任何可以放值的地方，比如SELECT-WHERE-HAVING"><a href="#把子查询的结果当做一个值，可以出现在任何可以放值的地方，比如SELECT-WHERE-HAVING" class="headerlink" title="把子查询的结果当做一个值，可以出现在任何可以放值的地方，比如SELECT,WHERE,HAVING"></a>把子查询的结果当做一个值，可以出现在任何可以放值的地方，比如SELECT,WHERE,HAVING</h3></li>
<li><h3 id="子查询的结果必须是单个元组的单个属性（即一行一列，只有单个值）"><a href="#子查询的结果必须是单个元组的单个属性（即一行一列，只有单个值）" class="headerlink" title="子查询的结果必须是单个元组的单个属性（即一行一列，只有单个值）"></a>子查询的结果必须是单个元组的单个属性（即一行一列，只有单个值）</h3><blockquote>
<h2 id="带子查询的DELETE语句"><a href="#带子查询的DELETE语句" class="headerlink" title="带子查询的DELETE语句"></a>带子查询的DELETE语句</h2></blockquote>
</li>
<li><p>举个栗子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的语句可以用来删除所有销售部的员工的信息</span></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> DEPTNO = (</span><br><span class="line">  <span class="keyword">SELECT</span> DEPT.DEPTNO</span><br><span class="line">  <span class="keyword">FROM</span> DEPT</span><br><span class="line">  <span class="keyword">WHERE</span> DNAME = <span class="string">'SALES'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h2 id="带子查询的INSERT语句"><a href="#带子查询的INSERT语句" class="headerlink" title="带子查询的INSERT语句"></a>带子查询的INSERT语句</h2></blockquote>
<ul>
<li><p>基本格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &lt; 表名 &gt;（字段序列）</span><br><span class="line">子查询</span><br></pre></td></tr></table></figure>
</li>
<li><p>举个栗子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 由于SQL Server中是没有dual这张系统表的，而Oracle和MySQL数据库中是有的，所以下面的测试是在MySQL中测试的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的语句很巧妙的实现了：</span></span><br><span class="line"><span class="comment">--如果部门表中没有部门号为666的部门的话，就将摸鱼部门的信息插入到部门表中</span></span><br><span class="line"><span class="comment">--如果部门表中有部门号为666的部门，则不执行插入操作</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT (DEPTNO, DNAME, LOC)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'666'</span>, <span class="string">'MOYU'</span>, <span class="string">'DUT'</span></span><br><span class="line"><span class="keyword">FROM</span> dual</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> *</span><br><span class="line">              <span class="keyword">FROM</span> EMP</span><br><span class="line">              <span class="keyword">WHERE</span> DEPTNO = <span class="string">'666'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h2 id="UPDATE语句的扩展"><a href="#UPDATE语句的扩展" class="headerlink" title="UPDATE语句的扩展"></a>UPDATE语句的扩展</h2></blockquote>
<ul>
<li><h3 id="有下面几个扩展"><a href="#有下面几个扩展" class="headerlink" title="有下面几个扩展"></a>有下面几个扩展</h3><ul>
<li>可以嵌入子查询（这个不在举例，和上面的用法类似）</li>
<li>case分支结构</li>
</ul>
</li>
<li><h3 id="case分支结构-可以有效的避免更新次序引发的问题"><a href="#case分支结构-可以有效的避免更新次序引发的问题" class="headerlink" title="case分支结构(可以有效的避免更新次序引发的问题)"></a>case分支结构(可以有效的避免更新次序引发的问题)</h3><ul>
<li><p>第一种用法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CASE WHEN &lt;条件&gt;</span><br><span class="line">        THEN ...</span><br><span class="line">     WHEN &lt;条件&gt;</span><br><span class="line">        THEN ...</span><br><span class="line">        ...</span><br><span class="line">    ELSE ...</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二种用法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE &lt;条件&gt;</span><br><span class="line">WHEN &lt;值&gt; THEN ...</span><br><span class="line">WHEN &lt;值&gt; THEN ...</span><br><span class="line">...</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对比两种方法，可以将第一种方法类比成其他编程语言的if-else分支语句，而将第二种用法类比成switch语句</p>
</li>
<li>举个栗子<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们的需求是给员工涨工资，工资大于等于3000的涨2%</span></span><br><span class="line"><span class="comment">-- 工资大于等于两千的涨3%</span></span><br><span class="line"><span class="comment">-- 工资小于2000的涨5%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--第一种尝试</span></span><br><span class="line"><span class="keyword">UPDATE</span> EMP</span><br><span class="line"><span class="keyword">SET</span> SAL = SAL * <span class="number">1.02</span></span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt;= <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> EMP</span><br><span class="line"><span class="keyword">SET</span> SAL = SAL * <span class="number">1.03</span></span><br><span class="line"><span class="keyword">WHERE</span> SAL &gt;= <span class="number">2000</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> EMP</span><br><span class="line"><span class="keyword">SET</span> SAL = SAL * <span class="number">1.05</span></span><br><span class="line"><span class="keyword">WHERE</span> SAL &lt; <span class="number">2000</span>;</span><br><span class="line"><span class="comment">--会发现上面执行的次序不一样会导致结果不一样，如果把第三个更新语句先执行，那么可能某个工资低于2000的员工涨了一次工资后工资大于两千了，于是执行第二个更新语句的时候又给他涨了一遍工资</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二种尝试</span></span><br><span class="line"><span class="comment">--下面就完美的实现了上面的需求，而且没有执行次序导致的问题</span></span><br><span class="line"><span class="keyword">UPDATE</span> EMP</span><br><span class="line"><span class="keyword">SET</span> SAL = <span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> SAL &gt;= <span class="number">3000</span> <span class="keyword">THEN</span> SAL * <span class="number">1.02</span></span><br><span class="line">    <span class="keyword">WHEN</span> SAL &gt;= <span class="number">2000</span> <span class="keyword">THEN</span> SAL * <span class="number">1.03</span></span><br><span class="line">    <span class="keyword">ELSE</span> SAL * <span class="number">1.05</span></span><br><span class="line">    <span class="keyword">END</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h4 id="case分支结构不止可以用在update子句中，在select子句中也是有的"><a href="#case分支结构不止可以用在update子句中，在select子句中也是有的" class="headerlink" title="case分支结构不止可以用在update子句中，在select子句中也是有的"></a>case分支结构不止可以用在update子句中，在select子句中也是有的</h4><blockquote>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>啊啊啊啊啊，这个内容还不是三言两语讲的玩的，下次吧下次吧。&gt;.&lt;</p>
</blockquote>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar-r.jpg"
                alt="建明 | Ming.J" />
            
              <p class="site-author-name" itemprop="name">建明 | Ming.J</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">建明 | Ming.J</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 99614, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/99614/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	
















  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("eyIFq6kYslRSDIa8lqlCIThp-gzGzoHsz", "iUAeNEuxcBmYdpgAATCh4AlH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
