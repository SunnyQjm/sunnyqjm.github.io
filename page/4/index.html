<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'ANPOHDJJYB',
      apiKey: '',
      indexName: 'Ming.J blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索文章","hits_empty":"没有找到任何结果呦T_T: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="建明 | Ming.J">
<meta property="og:url" content="http://qjm253.cn/page/4/index.html">
<meta property="og:site_name" content="建明 | Ming.J">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="建明 | Ming.J">





  
  
  <link rel="canonical" href="http://qjm253.cn/page/4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>建明 | Ming.J – 至清  至静</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">建明 | Ming.J</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">至清  至静</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-首页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-关于">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-分类">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/SunnyQjm" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2018/01/24/js_01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/24/js_01/" class="post-title-link" itemprop="url">JavaScript实现监听移动端上下左右滑动事件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-24 00:00:00" itemprop="dateCreated datePublished" datetime="2018-01-24T00:00:00+08:00">2018-01-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-20 10:55:18" itemprop="dateModified" datetime="2019-04-20T10:55:18+08:00">2019-04-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>最近刚入坑web前端，学了一点基础，便准备写个简单的2048小游戏试试手。开发过程中发现，<br>PC端可以直接监听键盘输入，但是移动端就不得不监听屏幕上的滑动事件了。</p>
</blockquote>
<ul>
<li>现有的js库中没有可以直接满足上述要求的封装</li>
<li>在JQuery Mobile 中 可以通过 .on 的方式监听左右滑动事件，但是没有上下滑动事件（而且我想写一个PC端和移动端都通用的网页的话，就必须引入Jquery，同时引入Jquery和Jquery Mobile 使得Bootstrap中的按钮样式改变了，这显然不是想要的结果）</li>
<li>所以为了保持PC端和移动端的一致性，决定直接封装一下js的移动端的触摸事件，实现上述需求</li>
</ul>
<blockquote>
<h2 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h2><p>可以在手机上打开，仍然具有不错的交互</p>
</blockquote>
<ul>
<li><a href="../../../../2048">点我体验</a></li>
<li><a href="https://github.com/SunnyQjm/2048" target="_blank" rel="noopener">源码地址</a></li>
<li><img src="/img/game_01.png" width="500" height="500" title="2048">
</li>
</ul>
<blockquote>
<h2 id="JS-触摸事件（event）"><a href="#JS-触摸事件（event）" class="headerlink" title="JS 触摸事件（event）"></a>JS 触摸事件（event）</h2></blockquote>
<ul>
<li><h3 id="event的类型"><a href="#event的类型" class="headerlink" title="event的类型"></a>event的类型</h3><ul>
<li>touchstart: 当<strong>手指触摸屏幕时</strong>触发（相当于Android中的ACTION_DOWN事件）</li>
<li>touchmove: 当<strong>手指在屏幕上滑动时</strong>连续触发（相当于Android中的ACTION_MOVE事件）— <strong><em>期间调用preventDefault()可以屏蔽事件的默认行为，达到阻止滚动的效果</em></strong></li>
<li>touchend: 当<strong>手指从屏幕上移开时</strong>触发（相当与Android中的ACTION_UP）</li>
<li>touchcancel: 当系统停止跟踪触摸时触发。关于此事件的触发时机，文档中没有明确说明（我们在接下来的过程中也用不到）</li>
</ul>
</li>
<li><h3 id="event用于跟踪触摸的属性"><a href="#event用于跟踪触摸的属性" class="headerlink" title="event用于跟踪触摸的属性"></a>event用于跟踪触摸的属性</h3><ul>
<li>touches: 表示当前跟踪的触摸操作的Touch对象的数组</li>
<li>targetTouches: 特定于事件目标的Touch对象数组</li>
<li>changeTouches: 表示子上次触摸以来发生了什么改变的Touch对象的数组<blockquote>
<p>注意： 在touchend事件发生时，event的touches对象中就没有元素了，需要到changeTouches中去获取触摸离开时的位置信息</p>
</blockquote>
</li>
</ul>
</li>
<li><h3 id="Touch对象包含的数组"><a href="#Touch对象包含的数组" class="headerlink" title="Touch对象包含的数组"></a>Touch对象包含的数组</h3><ul>
<li>clentX: 触摸目标在窗口中的x坐标</li>
<li>clientY: 触摸目标在窗口中的y坐标</li>
<li>identifier: 标识触摸的唯一ID</li>
<li>pageX： 触摸目标在页面中的x坐标</li>
<li>pageY： 触摸目标在页面中的y坐标</li>
<li>screenX： 触摸目标在屏幕中的x坐标</li>
<li>screenY： 触摸目标在屏幕中的y坐标</li>
<li>target：触摸的DOM节点目标</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="封装一个操作对象"><a href="#封装一个操作对象" class="headerlink" title="封装一个操作对象"></a>封装一个操作对象</h2><p>该对象的封装，前两个函数参考书籍《JavaScript 高级程序设计》（第三版）</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    addHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element.addEventListener)</span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent)</span><br><span class="line">            element.attachEvent(<span class="string">"on"</span> + type, handler);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            element[<span class="string">"on"</span> + type] = handler;</span><br><span class="line">    &#125;,</span><br><span class="line">    removeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.removeEventListener)</span><br><span class="line">            element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)</span><br><span class="line">            element.detachEvent(<span class="string">"on"</span> + type, handler);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            element[<span class="string">"on"</span> + type] = handler;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听触摸的方向</span></span><br><span class="line"><span class="comment">     * @param target            要绑定监听的目标元素</span></span><br><span class="line"><span class="comment">     * @param isPreventDefault  是否屏蔽掉触摸滑动的默认行为（例如页面的上下滚动，缩放等）</span></span><br><span class="line"><span class="comment">     * @param upCallback        向上滑动的监听回调（若不关心，可以不传，或传false）</span></span><br><span class="line"><span class="comment">     * @param rightCallback     向右滑动的监听回调（若不关心，可以不传，或传false）</span></span><br><span class="line"><span class="comment">     * @param downCallback      向下滑动的监听回调（若不关心，可以不传，或传false）</span></span><br><span class="line"><span class="comment">     * @param leftCallback      向左滑动的监听回调（若不关心，可以不传，或传false）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    listenTouchDirection: <span class="function"><span class="keyword">function</span> (<span class="params">target, isPreventDefault, upCallback, rightCallback, downCallback, leftCallback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.addHandler(target, <span class="string">"touchstart"</span>, handleTouchEvent);</span><br><span class="line">        <span class="keyword">this</span>.addHandler(target, <span class="string">"touchend"</span>, handleTouchEvent);</span><br><span class="line">        <span class="keyword">this</span>.addHandler(target, <span class="string">"touchmove"</span>, handleTouchEvent);</span><br><span class="line">        <span class="keyword">var</span> startX;</span><br><span class="line">        <span class="keyword">var</span> startY;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">handleTouchEvent</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (event.type)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"touchstart"</span>:</span><br><span class="line">                    startX = event.touches[<span class="number">0</span>].pageX;</span><br><span class="line">                    startY = event.touches[<span class="number">0</span>].pageY;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"touchend"</span>:</span><br><span class="line">                    <span class="keyword">var</span> spanX = event.changedTouches[<span class="number">0</span>].pageX - startX;</span><br><span class="line">                    <span class="keyword">var</span> spanY = event.changedTouches[<span class="number">0</span>].pageY - startY;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">Math</span>.abs(spanX) &gt; <span class="built_in">Math</span>.abs(spanY))&#123;      <span class="comment">//认定为水平方向滑动</span></span><br><span class="line">                        <span class="keyword">if</span>(spanX &gt; <span class="number">30</span>)&#123;         <span class="comment">//向右</span></span><br><span class="line">                            <span class="keyword">if</span>(rightCallback)</span><br><span class="line">                                rightCallback();</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(spanX &lt; <span class="number">-30</span>)&#123; <span class="comment">//向左</span></span><br><span class="line">                            <span class="keyword">if</span>(leftCallback)</span><br><span class="line">                                leftCallback();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;                                    <span class="comment">//认定为垂直方向滑动</span></span><br><span class="line">                        <span class="keyword">if</span>(spanY &gt; <span class="number">30</span>)&#123;         <span class="comment">//向下</span></span><br><span class="line">                            <span class="keyword">if</span>(downCallback)</span><br><span class="line">                                downCallback();</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (spanY &lt; <span class="number">-30</span>) &#123;<span class="comment">//向上</span></span><br><span class="line">                            <span class="keyword">if</span>(upCallback)</span><br><span class="line">                                upCallback();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"touchmove"</span>:</span><br><span class="line">                    <span class="comment">//阻止默认行为</span></span><br><span class="line">                    <span class="keyword">if</span>(isPreventDefault)</span><br><span class="line">                        event.preventDefault();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用的时候很简单，只需要向下面这样调用即可</span></span><br><span class="line"><span class="comment">//其中下面监听的是整个DOM</span></span><br><span class="line"><span class="comment">//up, right, down, left为四个回调函数，分别处理上下左右的滑动事件</span></span><br><span class="line">EventUtil.listenTouchDirection(<span class="built_in">document</span>, <span class="literal">true</span>, up， right, down, left)</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2018/01/06/super_c_n/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/06/super_c_n/" class="post-title-link" itemprop="url">高C考试说明</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-06 23:00:00" itemprop="dateCreated datePublished" datetime="2018-01-06T23:00:00+08:00">2018-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-20 10:55:18" itemprop="dateModified" datetime="2019-04-20T10:55:18+08:00">2019-04-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2></blockquote>
<ul>
<li>最后一个高C课，老师旁边围了一圈，就有了如下信息</li>
</ul>
<blockquote>
<h2 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h2></blockquote>
<ul>
<li>简答：50</li>
<li>编程：30</li>
<li>实验：20 （代码分析，分析哪里错了…）</li>
</ul>
<blockquote>
<h2 id="以下不用看"><a href="#以下不用看" class="headerlink" title="以下不用看"></a>以下不用看</h2><p>括号里是我加的，以防万一</p>
</blockquote>
<ul>
<li>timewait不用看</li>
<li>key managment不用看 （知道怎么创建一个秘钥管理套接字：socket(PF_KEY, SOCK_RAW, 0)）</li>
<li>ioctl 不用看</li>
</ul>
<blockquote>
<h2 id="老师说会考"><a href="#老师说会考" class="headerlink" title="老师说会考"></a>老师说会考</h2></blockquote>
<ul>
<li>前几章重点</li>
<li>大端小端代码</li>
<li>traceroute、ping会考（研究生学长说不考，但是今年王老师出卷，其它先复习，有时间看看ping和traceroute的源码）</li>
<li>HDR_INCL套接字选项（原始套接字设置该选项可以自己构造IP首部）</li>
<li>BPF、DLPI、SOCK_PACKET（三种提供链路层访问控制的方式）</li>
<li>掌握netstat怎么用（用于显示各个端口的状态）</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2018/01/06/super_c_m/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/06/super_c_m/" class="post-title-link" itemprop="url">高级C与网络编程复习（13）—— 线程（Threads）（第26章）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-06 19:00:00" itemprop="dateCreated datePublished" datetime="2018-01-06T19:00:00+08:00">2018-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-20 10:55:18" itemprop="dateModified" datetime="2019-04-20T10:55:18+08:00">2019-04-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2></blockquote>
<ul>
<li><h3 id="用fork实现并发要求存在的问题"><a href="#用fork实现并发要求存在的问题" class="headerlink" title="用fork实现并发要求存在的问题"></a>用fork实现并发要求存在的问题</h3><ul>
<li>fork的代价是比较昂贵的</li>
<li>fork返回之后父子进程之间的信息传递需要进程间通信(IPC)机制。</li>
</ul>
</li>
<li><h3 id="使用线程可以有效的解决上面的问题"><a href="#使用线程可以有效的解决上面的问题" class="headerlink" title="使用线程可以有效的解决上面的问题"></a>使用线程可以有效的解决上面的问题</h3><ul>
<li>线程的创建是轻量级的，线程也被称为轻权进程（lightweight process）。线程的创建可能比进程快10~100倍</li>
<li>同一进程内的所有线程共享全局内存，这使得线程之间易于共享信息，然后随之而来的便是同步(synchronization)问题</li>
</ul>
</li>
<li><h3 id="同一进程内的线程共享："><a href="#同一进程内的线程共享：" class="headerlink" title="同一进程内的线程共享："></a>同一进程内的线程共享：</h3><ul>
<li>全局变量</li>
<li>进程指令（process instruction）</li>
<li>大多数数据（most data）</li>
<li>打开的文件（open file）==&gt; 即描述符</li>
<li>信号处理函数和信号处置（Signal handlers and signal disposition）</li>
<li>当前工作目录（Current working directory）</li>
<li>用户ID和组ID（User and group ID）</li>
</ul>
</li>
<li><h3 id="线程独享以下内容："><a href="#线程独享以下内容：" class="headerlink" title="线程独享以下内容："></a>线程独享以下内容：</h3><ul>
<li>线程ID （thread ID）</li>
<li>寄存器集合，包括程序计数器和栈指针 （Set of registers， including program counter and stack pointer）</li>
<li>栈（用于存放局部变量和返回地址）  Stack（for local variables and return address）</li>
<li>errno ==&gt; 全局动态变量（记录最近的一次错误）</li>
<li>信号掩码(Signal mask)</li>
<li>优先级(Priority)</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2018/01/06/super_c_l/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/06/super_c_l/" class="post-title-link" itemprop="url">高级C与网络编程复习（12）—— 路由套接字和秘钥管理套接字（Routing Sockets and Key Managment Sockets）（第18章，第19章）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-06 18:00:00" itemprop="dateCreated datePublished" datetime="2018-01-06T18:00:00+08:00">2018-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-20 10:55:18" itemprop="dateModified" datetime="2019-04-20T10:55:18+08:00">2019-04-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>AF_ROUTE domain: <strong>唯一支持的套接字是原始套接字</strong>(raw socket)</p>
</blockquote>
<ul>
<li><h3 id="一个路由套接字上支持以下的三种操作"><a href="#一个路由套接字上支持以下的三种操作" class="headerlink" title="一个路由套接字上支持以下的三种操作"></a>一个路由套接字上支持以下的三种操作</h3><ol>
<li>通过往路由套接字写数据来<strong>向内核发送消息</strong>（例如: 添加或删除路由）</li>
<li>通过从路由套接字读数据来<strong>接收内核发送的消息</strong>（例如：内核在接收到一个ICMP重定向消息的时候，就通过这种方式通知进程）</li>
<li>进程可以使用<strong>sysctl函数倾泻出路由表或列出所有已配置的接口</strong></li>
</ol>
</li>
<li><p>前两种需要超级权限，最后一种操作任何进程都可以执行</p>
</li>
<li><p>前两种可以复合起来使用，比如：进程通过写一个路由套接字往内核发送一个消息，请求内核提供关于某个给定路径的所有信息，又通过这个这个路由套接字接收内核的应答</p>
</li>
</ul>
<blockquote>
<h2 id="数据链路套接字地址结构"><a href="#数据链路套接字地址结构" class="headerlink" title="数据链路套接字地址结构"></a>数据链路套接字地址结构</h2></blockquote>
<figure class="highlight c"><figcaption><span><br>&ensp; <net if_dl.h></net></span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_dl</span>&#123;</span></span><br><span class="line">  <span class="keyword">uint8_t</span>       sdl_len;           <span class="comment">//数据链路层地址是可变长度的，这个成员即为记录地址结构的长度</span></span><br><span class="line">  <span class="keyword">sa_family_t</span>   sdl_family;        <span class="comment">//AF_LINK</span></span><br><span class="line">  <span class="keyword">uint16_t</span>      sdl_index;         <span class="comment">//网络接口的正值索引，if &gt; 0</span></span><br><span class="line">  <span class="keyword">uint8_t</span>       sdl_type;          <span class="comment">//IFT_ETHER等</span></span><br><span class="line">  <span class="keyword">uint8_t</span>       sdl_nlen;          <span class="comment">//名字的长度</span></span><br><span class="line">  <span class="keyword">uint8_t</span>       sdl_alen;          <span class="comment">//链路层地址的长度</span></span><br><span class="line">  <span class="keyword">uint8_t</span>       sdl_slen;          <span class="comment">//链路层选择器的长度</span></span><br><span class="line">  <span class="keyword">char</span>          sdl_data[<span class="number">12</span>];      <span class="comment">//数据域:         0 ~ sdl_nlen - 1  ==&gt;  name</span></span><br><span class="line">                                   <span class="comment">//         sdl_len ~ sdl_alen - 1  ==&gt;  link-layer address</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="创建一个路由套接字"><a href="#创建一个路由套接字" class="headerlink" title="创建一个路由套接字"></a>创建一个路由套接字</h2></blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sockfd;</span><br><span class="line">sockfd = socket(AF_ROUTE, SOCK_RAW, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="Key-Managment-概述"><a href="#Key-Managment-概述" class="headerlink" title="Key Managment 概述"></a>Key Managment 概述</h2></blockquote>
<ul>
<li>PE_KEY domain: <strong>唯一支持的套接字是原始套接字</strong>(raw socket)</li>
</ul>
<blockquote>
<h2 id="创建一个秘钥管理套接字"><a href="#创建一个秘钥管理套接字" class="headerlink" title="创建一个秘钥管理套接字"></a>创建一个秘钥管理套接字</h2></blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sockfd;</span><br><span class="line">sockfd = socket(PF_KEY, SOCK_RAW, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qjm253.cn/2018/01/06/super_c_k/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="建明 | Ming.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="建明 | Ming.J">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/06/super_c_k/" class="post-title-link" itemprop="url">高级C与网络编程复习（11）—— 数据链路访问（Datalink Access）（第29章）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-06 17:00:00" itemprop="dateCreated datePublished" datetime="2018-01-06T17:00:00+08:00">2018-01-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-20 10:55:18" itemprop="dateModified" datetime="2019-04-20T10:55:18+08:00">2019-04-20</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>目前大多数操作系统都为应用程序提供访问数据链路层的功能，这种功能可提供如下能力</p>
</blockquote>
<ul>
<li><strong>能够监视由数据链路层接收的分组</strong>，使得诸如tcpdump之类的程序能够在普通计算机系统上运行，而<strong>无需使用专门的硬件设备来监视分组</strong>。如果使网络接口进入<strong>混杂模式</strong>(promiscuous mode)，<strong>甚至可以监听</strong>本地电缆上流通的<strong>所有分组</strong><ul>
<li>The ability to watch the packets received by the datalink layer, allowing programs such as tcpdump to be run on normal computer systems (as opposed to dedicated hardware devices to watch packets). (promiscuous mode)</li>
</ul>
</li>
<li>能够<strong>作为普通应用进程</strong>而不是内核<strong>的一部分运行某些程序</strong>，例如：RARP<ul>
<li>The ability to run certain programs as normal applications instead of as part of the kernel. For example, most Unix versions of an RARP server are normal applications that read RARP requests from the datalink (RARP requests are not IP datagrams) and then write the reply back to the datalink</li>
</ul>
</li>
<li><strong>实现数据链路层访问的三个常见方法</strong>：<ul>
<li>BSD的分组过滤器<strong>BPF</strong></li>
<li>SVR4的数据链路提供者接口<strong>DLPI</strong></li>
<li>Linux的<strong>SOCK_PACKET</strong>接口</li>
</ul>
</li>
</ul>
<blockquote>
<h2 id="BPF"><a href="#BPF" class="headerlink" title="BPF"></a>BPF</h2><p>4.4BSD and many other Berkeley-derived implementations support BPF</p>
</blockquote>
<img src="/img/unp_45.png" title="使用BPF截获分组">
<blockquote>
<h2 id="DLPI"><a href="#DLPI" class="headerlink" title="DLPI"></a>DLPI</h2><p>SVR4 provides datalink access through DLPI(Datalink Provider Interface)</p>
</blockquote>
<img src="/img/unp_46.png" title="使用DLPI、pfmod和bufmod捕获分组">
<blockquote>
<h2 id="SOCK-PACKET-and-PF-PACKET"><a href="#SOCK-PACKET-and-PF-PACKET" class="headerlink" title="SOCK_PACKET and PF_PACKET"></a>SOCK_PACKET and PF_PACKET</h2><p>Two methods under Linux:</p>
<ul>
<li>SOCK_PACKET: original, widely available but less flexible</li>
<li>PF_PACKET: newer method</li>
</ul>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* newer systems*/</span></span><br><span class="line">fd = socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL));</span><br><span class="line"><span class="comment">/* older systems*/</span></span><br><span class="line">fd = socket(AF_INET, SOCK_PACKET, htons(ETH_P_ALL));</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="相关库"><a href="#相关库" class="headerlink" title="相关库"></a>相关库</h2></blockquote>
<ul>
<li>libpcap: 分组捕获函数和库</li>
<li>libnet：分组构造与输出库</li>
</ul>
<blockquote>
<h2 id="检查UDP校验和字段的栗子"><a href="#检查UDP校验和字段的栗子" class="headerlink" title="检查UDP校验和字段的栗子"></a>检查UDP校验和字段的栗子</h2><p>见课本 图29-3</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">建明 | Ming.J</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">建明 | Ming.J</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  



  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>



  
  







  
  
  <script id="ribbon" size="300" alpha="0.2" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>





  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>

  
  <script src="/lib/three/three.min.js"></script>

  
  <script src="/lib/three/three-waves.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
<script>
if ($('body').find('pre.mermaid').length) {
  $.ajax({
    type: 'GET',
    url: '//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js',
    dataType: 'script',
    cache: true,
    success: function() {
      mermaid.initialize({
        theme: 'forest',
        logLevel: 3,
        flowchart: { curve: 'linear' },
        gantt: { axisFormat: '%m/%d/%Y' },
        sequence: { actorMargin: 50 }
      });
    }
  });
}
</script>


  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
